{"timestamp": "2025-11-18T00:30:13.157+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "logger_initialized", "app_name": "ada"}
{"timestamp": "2025-11-18T00:30:42.423+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "Show monthly revenue by product in 2025.", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:42.431+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:42.450+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:42.455+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=40)", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:42.455+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:46.156+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:46.156+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='Show monthly revenue by product in 2025.', metrics=['actual_revenue'], dimensions=['product', 'month'], time_grain='monthly', time_range='past_3_years', filters=[Filter(field='year', op='=', value=2025)], sort=None, top_k=None, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['Use a line or bar chart to show actual revenue over months.', 'Group data by product to show multiple series.', 'X-axis represents months, Y-axis represents actual revenue.', 'Include a legend for products.', \"Title the chart 'Monthly Revenue by Product in 2025'.\"]), chart_figure_json=None, narrative=None)]", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:46.161+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:46.161+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:46.162+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:46.163+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:46.164+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:46.165+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:46.166+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:46.167+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['actual_revenue'] dims=['product', 'month']", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:46.168+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:50.542+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4018, "completion_tokens": 218, "total_tokens": 4236, "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:50.542+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=818)", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:50.543+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=818)", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:50.544+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:50.544+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=818):\nWITH base AS (\n  SELECT\n    fact_sales.product_sk,\n    dim_product.product_name,\n    dim_date.date,\n    COALESCE(fact_sales.revenue, fact_sales.quantity * fact_sales.unit_price) AS actual_revenue,\n    dim_date.year\n  FROM public.fact_sales\n  JOIN public.dim_product ON fact_sales.product_sk = dim_product.product_sk\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE dim_date.date >= make_date(extract(year from current_date)::int - 2, 1, 1)\n    AND dim_date.year = 2025\n),\nagg AS (\n  SELECT\n    date_trunc('month', base.date)::date AS period,\n    base.product_name,\n    SUM(base.actual_revenue) AS actual_revenue\n  FROM base\n  GROUP BY 1, 2\n)\nSELECT\n  agg.period,\n  agg.product_name AS product,\n  agg.actual_revenue\nFROM agg\nORDER BY agg.actual_revenue DESC, agg.period ASC, agg.product_name ASC;", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:50.546+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:50.583+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:50.583+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:50.584+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:50.585+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:50.649+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=143, cols=3)", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:50.649+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=143, cols=3)", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:50.652+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (143, 3)", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:50.654+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:50.656+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: Show monthly revenue by product in 2025.", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:50.656+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['Use a line or bar chart to show actual revenue over months.', 'Group data by product to show multiple series.', 'X-axis represents months, Y-axis represents actual revenue.', 'Include a legend for products.', \"Title the chart 'Monthly Revenue by Product in 2025'.\"]}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"period\":\"2025-01-01\",\"product\":\"Earbuds S\",\"actual_revenue\":125595.29},{\"period\":\"2025-01-01\",\"product\":\"Phone X1\",\"actual_revenue\":1573077.3100000001},{\"period\":\"2025-01-01\",\"product\":\"Phone X1 Pro\",\"actual_revenue\":2014955.71},{\"period\":\"2025-01-01\",\"product\":\"Smartwatch G\",\"actual_revenue\":328570.62},{\"period\":\"2025-01-01\",\"product\":\"Laptop Pro 15\",\"actual_revenue\":3206650.1499999999},{\"period\":\"2025-01-01\",\"product\":\"All Products Accessories\",\"actual_revenue\":0.0},{\"period\":\"2025-01-01\",\"product\":\"Laptop Air 13\",\"actual_revenue\":2063370.3300000001},{\"period\":\"2025-01-01\",\"product\":\"All Products Computers\",\"actual_revenue\":0.0},{\"period\":\"2025-01-01\",\"product\":\"Gaming Mouse Z\",\"actual_revenue\":94807.5},{\"period\":\"2025-01-01\",\"product\":\"All Products Electronics\",\"actual_revenue\":0.0},{\"period\":\"2025-01-01\",\"product\":\"All Products Peripherals\",\"actual_revenue\":0.0},{\"period\":\"2025-01-01\",\"product\":\"4K Monitor 27\\\"\",\"actual_revenue\":602988.25},{\"period\":\"2025-01-01\",\"product\":\"All Products Wearables\",\"actual_revenue\":0.0},{\"period\":\"2025-02-01\",\"product\":\"Smartwatch G\",\"actual_revenue\":287932.62},{\"period\":\"2025-02-01\",\"product\":\"Gaming Mouse Z\",\"actual_revenue\":75399.56},{\"period\":\"2025-02-01\",\"product\":\"Earbuds S\",\"actual_revenue\":126471.47},{\"period\":\"2025-02-01\",\"product\":\"4K Monitor 27\\\"\",\"actual_revenue\":592505.74},{\"period\":\"2025-02-01\",\"product\":\"Laptop Air 13\",\"actual_revenue\":2422884.1299999999},{\"period\":\"2025-02-01\",\"product\":\"All Products Accessories\",\"actual_revenue\":0.0},{\"period\":\"2025-02-01\",\"product\":\"Laptop Pro 15\",\"actual_revenue\":2522579.2000000002},{\"period\":\"2025-02-01\",\"product\":\"All Products Computers\",\"actual_revenue\":0.0},{\"period\":\"2025-02-01\",\"product\":\"All Products Electronics\",\"actual_revenue\":0.0},{\"period\":\"2025-02-01\",\"product\":\"All Products Peripherals\",\"actual_revenue\":0.0},{\"period\":\"2025-02-01\",\"product\":\"All Products Wearables\",\"actual_revenue\":0.0},{\"period\":\"2025-02-01\",\"product\":\"Phone X1\",\"actual_revenue\":1262694.4399999999},{\"period\":\"2025-02-01\",\"product\":\"Phone X1 Pro\",\"actual_revenue\":1974660.8899999999},{\"period\":\"2025-03-01\",\"product\":\"Phone X1 Pro\",\"actual_revenue\":1873861.0800000001},{\"period\":\"2025-03-01\",\"product\":\"Phone X1\",\"actual_revenue\":1673363.97},{\"period\":\"2025-03-01\",\"product\":\"4K Monitor 27\\\"\",\"actual_revenue\":712525.63},{\"period\":\"2025-03-01\",\"product\":\"All Products Peripherals\",\"actual_revenue\":0.0},{\"period\":\"2025-03-01\",\"product\":\"Laptop Air 13\",\"actual_revenue\":2130011.6699999999},{\"period\":\"2025-03-01\",\"product\":\"Earbuds S\",\"actual_revenue\":138298.05},{\"period\":\"2025-03-01\",\"product\":\"All Products Electronics\",\"actual_revenue\":0.0},{\"period\":\"2025-03-01\",\"product\":\"All Products Accessories\",\"actual_revenue\":0.0},{\"period\":\"2025-03-01\",\"product\":\"All Products Computers\",\"actual_revenue\":0.0},{\"period\":\"2025-03-01\",\"product\":\"Laptop Pro 15\",\"actual_revenue\":3471580.5099999998},{\"period\":\"2025-03-01\",\"product\":\"Smartwatch G\",\"actual_revenue\":272551.5},{\"period\":\"2025-03-01\",\"product\":\"All Products Wearables\",\"actual_revenue\":0.0},{\"period\":\"2025-03-01\",\"product\":\"Gaming Mouse Z\",\"actual_revenue\":90560.91},{\"period\":\"2025-04-01\",\"product\":\"Earbuds S\",\"actual_revenue\":157464.21},{\"period\":\"2025-04-01\",\"product\":\"4K Monitor 27\\\"\",\"actual_revenue\":652552.09},{\"period\":\"2025-04-01\",\"product\":\"All Products Wearables\",\"actual_revenue\":0.0},{\"period\":\"2025-04-01\",\"product\":\"Phone X1\",\"actual_revenue\":1737814.3999999999},{\"period\":\"2025-04-01\",\"product\":\"Phone X1 Pro\",\"actual_revenue\":2110221.2000000002},{\"period\":\"2025-04-01\",\"product\":\"Laptop Pro 15\",\"actual_revenue\":3211531.0699999998},{\"period\":\"2025-04-01\",\"product\":\"Laptop Air 13\",\"actual_revenue\":2354859.9100000001},{\"period\":\"2025-04-01\",\"product\":\"All Products Accessories\",\"actual_revenue\":0.0},{\"period\":\"2025-04-01\",\"product\":\"All Products Computers\",\"actual_revenue\":0.0},{\"period\":\"2025-04-01\",\"product\":\"All Products Electronics\",\"actual_revenue\":0.0},{\"period\":\"2025-04-01\",\"product\":\"Smartwatch G\",\"actual_revenue\":283199.34},{\"period\":\"2025-04-01\",\"product\":\"All Products Peripherals\",\"actual_revenue\":0.0},{\"period\":\"2025-04-01\",\"product\":\"Gaming Mouse Z\",\"actual_revenue\":81381.77},{\"period\":\"2025-05-01\",\"product\":\"Smartwatch G\",\"actual_revenue\":288533.06},{\"period\":\"2025-05-01\",\"product\":\"Laptop Pro 15\",\"actual_revenue\":3645070.4900000002},{\"period\":\"2025-05-01\",\"product\":\"All Products Peripherals\",\"actual_revenue\":0.0},{\"period\":\"2025-05-01\",\"product\":\"All Products Electronics\",\"actual_revenue\":0.0},{\"period\":\"2025-05-01\",\"product\":\"All Products Wearables\",\"actual_revenue\":0.0},{\"period\":\"2025-05-01\",\"product\":\"4K Monitor 27\\\"\",\"actual_revenue\":611152.95},{\"period\":\"2025-05-01\",\"product\":\"All Products Computers\",\"actual_revenue\":0.0},{\"period\":\"2025-05-01\",\"product\":\"Phone X1 Pro\",\"actual_revenue\":2147613.0299999998},{\"period\":\"2025-05-01\",\"product\":\"Earbuds S\",\"actual_revenue\":127879.43},{\"period\":\"2025-05-01\",\"product\":\"Gaming Mouse Z\",\"actual_revenue\":87253.38},{\"period\":\"2025-05-01\",\"product\":\"All Products Accessories\",\"actual_revenue\":0.0},{\"period\":\"2025-05-01\",\"product\":\"Phone X1\",\"actual_revenue\":1718808.28},{\"period\":\"2025-05-01\",\"product\":\"Laptop Air 13\",\"actual_revenue\":2267842.54},{\"period\":\"2025-06-01\",\"product\":\"Earbuds S\",\"actual_revenue\":115270.46},{\"period\":\"2025-06-01\",\"product\":\"Gaming Mouse Z\",\"actual_revenue\":82661.26},{\"period\":\"2025-06-01\",\"product\":\"All Products Accessories\",\"actual_revenue\":0.0},{\"period\":\"2025-06-01\",\"product\":\"All Products Peripherals\",\"actual_revenue\":0.0},{\"period\":\"2025-06-01\",\"product\":\"Laptop Air 13\",\"actual_revenue\":2002484.3},{\"period\":\"2025-06-01\",\"product\":\"4K Monitor 27\\\"\",\"actual_revenue\":587312.84},{\"period\":\"2025-06-01\",\"product\":\"All Products Wearables\",\"actual_revenue\":0.0},{\"period\":\"2025-06-01\",\"product\":\"Phone X1 Pro\",\"actual_revenue\":2072962.45},{\"period\":\"2025-06-01\",\"product\":\"All Products Electronics\",\"actual_revenue\":0.0},{\"period\":\"2025-06-01\",\"product\":\"Phone X1\",\"actual_revenue\":1555253.78},{\"period\":\"2025-06-01\",\"product\":\"Laptop Pro 15\",\"actual_revenue\":2674968.4199999999},{\"period\":\"2025-06-01\",\"product\":\"Smartwatch G\",\"actual_revenue\":307888.13},{\"period\":\"2025-06-01\",\"product\":\"All Products Computers\",\"actual_revenue\":0.0},{\"period\":\"2025-07-01\",\"product\":\"Earbuds S\",\"actual_revenue\":154703.85},{\"period\":\"2025-07-01\",\"product\":\"All Products Peripherals\",\"actual_revenue\":0.0},{\"period\":\"2025-07-01\",\"product\":\"All Products Electronics\",\"actual_revenue\":0.0},{\"period\":\"2025-07-01\",\"product\":\"Smartwatch G\",\"actual_revenue\":295604.55},{\"period\":\"2025-07-01\",\"product\":\"Phone X1\",\"actual_revenue\":1813375.8400000001},{\"period\":\"2025-07-01\",\"product\":\"All Products Computers\",\"actual_revenue\":0.0},{\"period\":\"2025-07-01\",\"product\":\"Phone X1 Pro\",\"actual_revenue\":2013600.1799999999},{\"period\":\"2025-07-01\",\"product\":\"4K Monitor 27\\\"\",\"actual_revenue\":670535.9300000001},{\"period\":\"2025-07-01\",\"product\":\"Laptop Pro 15\",\"actual_revenue\":3451856.9700000002},{\"period\":\"2025-07-01\",\"product\":\"All Products Accessories\",\"actual_revenue\":0.0},{\"period\":\"2025-07-01\",\"product\":\"All Products Wearables\",\"actual_revenue\":0.0},{\"period\":\"2025-07-01\",\"product\":\"Laptop Air 13\",\"actual_revenue\":2326885.7799999998},{\"period\":\"2025-07-01\",\"product\":\"Gaming Mouse Z\",\"actual_revenue\":94294.65},{\"period\":\"2025-08-01\",\"product\":\"Laptop Pro 15\",\"actual_revenue\":3108034.0499999998},{\"period\":\"2025-08-01\",\"product\":\"All Products Electronics\",\"actual_revenue\":0.0},{\"period\":\"2025-08-01\",\"product\":\"All Products Accessories\",\"actual_revenue\":0.0},{\"period\":\"2025-08-01\",\"product\":\"Phone X1 Pro\",\"actual_revenue\":2263577.2400000002},{\"period\":\"2025-08-01\",\"product\":\"All Products Computers\",\"actual_revenue\":0.0},{\"period\":\"2025-08-01\",\"product\":\"Laptop Air 13\",\"actual_revenue\":2056424.1399999999},{\"period\":\"2025-08-01\",\"product\":\"Smartwatch G\",\"actual_revenue\":270322.68},{\"period\":\"2025-08-01\",\"product\":\"All Products Wearables\",\"actual_revenue\":0.0},{\"period\":\"2025-08-01\",\"product\":\"Gaming Mouse Z\",\"actual_revenue\":97053.5},{\"period\":\"2025-08-01\",\"product\":\"All Products Peripherals\",\"actual_revenue\":0.0},{\"period\":\"2025-08-01\",\"product\":\"4K Monitor 27\\\"\",\"actual_revenue\":645778.42},{\"period\":\"2025-08-01\",\"product\":\"Earbuds S\",\"actual_revenue\":140281.52},{\"period\":\"2025-08-01\",\"product\":\"Phone X1\",\"actual_revenue\":1667458.4299999999},{\"period\":\"2025-09-01\",\"product\":\"All Products Electronics\",\"actual_revenue\":230167.05},{\"period\":\"2025-09-01\",\"product\":\"Laptop Pro 15\",\"actual_revenue\":3379587.3700000001},{\"period\":\"2025-09-01\",\"product\":\"Smartwatch G\",\"actual_revenue\":312217.92},{\"period\":\"2025-09-01\",\"product\":\"All Products Computers\",\"actual_revenue\":164919.82},{\"period\":\"2025-09-01\",\"product\":\"All Products Peripherals\",\"actual_revenue\":144291.87},{\"period\":\"2025-09-01\",\"product\":\"4K Monitor 27\\\"\",\"actual_revenue\":765128.37},{\"period\":\"2025-09-01\",\"product\":\"All Products Wearables\",\"actual_revenue\":134561.36},{\"period\":\"2025-09-01\",\"product\":\"All Products Accessories\",\"actual_revenue\":132482.77},{\"period\":\"2025-09-01\",\"product\":\"Gaming Mouse Z\",\"actual_revenue\":106596.38},{\"period\":\"2025-09-01\",\"product\":\"Phone X1\",\"actual_revenue\":1970471.54},{\"period\":\"2025-09-01\",\"product\":\"Phone X1 Pro\",\"actual_revenue\":1926775.1899999999},{\"period\":\"2025-09-01\",\"product\":\"Laptop Air 13\",\"actual_revenue\":2428223.3900000001},{\"period\":\"2025-09-01\",\"product\":\"Earbuds S\",\"actual_revenue\":143798.49},{\"period\":\"2025-10-01\",\"product\":\"Laptop Pro 15\",\"actual_revenue\":3860906.2599999998},{\"period\":\"2025-10-01\",\"product\":\"Smartwatch G\",\"actual_revenue\":427934.04},{\"period\":\"2025-10-01\",\"product\":\"Laptop Air 13\",\"actual_revenue\":2976651.9700000002},{\"period\":\"2025-10-01\",\"product\":\"Phone X1 Pro\",\"actual_revenue\":2590424.2000000002},{\"period\":\"2025-10-01\",\"product\":\"Phone X1\",\"actual_revenue\":2194267.3500000001},{\"period\":\"2025-10-01\",\"product\":\"4K Monitor 27\\\"\",\"actual_revenue\":881619.2},{\"period\":\"2025-10-01\",\"product\":\"All Products Electronics\",\"actual_revenue\":537420.03},{\"period\":\"2025-10-01\",\"product\":\"All Products Computers\",\"actual_revenue\":506679.67},{\"period\":\"2025-10-01\",\"product\":\"All Products Accessories\",\"actual_revenue\":405178.18},{\"period\":\"2025-10-01\",\"product\":\"All Products Peripherals\",\"actual_revenue\":403582.52},{\"period\":\"2025-10-01\",\"product\":\"Earbuds S\",\"actual_revenue\":182479.71},{\"period\":\"2025-10-01\",\"product\":\"Gaming Mouse Z\",\"actual_revenue\":112142.01},{\"period\":\"2025-10-01\",\"product\":\"All Products Wearables\",\"actual_revenue\":350523.56},{\"period\":\"2025-11-01\",\"product\":\"4K Monitor 27\\\"\",\"actual_revenue\":246963.48},{\"period\":\"2025-11-01\",\"product\":\"All Products Electronics\",\"actual_revenue\":180059.61},{\"period\":\"2025-11-01\",\"product\":\"Gaming Mouse Z\",\"actual_revenue\":27726.49},{\"period\":\"2025-11-01\",\"product\":\"Smartwatch G\",\"actual_revenue\":114331.92},{\"period\":\"2025-11-01\",\"product\":\"Phone X1\",\"actual_revenue\":549372.76},{\"period\":\"2025-11-01\",\"product\":\"Laptop Air 13\",\"actual_revenue\":741785.97},{\"period\":\"2025-11-01\",\"product\":\"Phone X1 Pro\",\"actual_revenue\":809641.12},{\"period\":\"2025-11-01\",\"product\":\"All Products Peripherals\",\"actual_revenue\":98502.47},{\"period\":\"2025-11-01\",\"product\":\"Laptop Pro 15\",\"actual_revenue\":1005238.83},{\"period\":\"2025-11-01\",\"product\":\"All Products Accessories\",\"actual_revenue\":80689.77},{\"period\":\"2025-11-01\",\"product\":\"All Products Computers\",\"actual_revenue\":76594.49},{\"period\":\"2025-11-01\",\"product\":\"All Products Wearables\",\"actual_revenue\":67490.99},{\"period\":\"2025-11-01\",\"product\":\"Earbuds S\",\"actual_revenue\":44141.36}]\n```", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:30:50.657+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=11988)", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:31:32.129+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4292, "completion_tokens": 2440, "total_tokens": 6732, "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:31:32.129+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=7320)", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:31:32.131+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:31:32.131+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=3886):\n{'data': [{'type': 'scatter', 'mode': 'lines+markers', 'name': 'Earbuds S', 'x': ['2025-01-01', '2025-02-01', '2025-03-01', '2025-04-01', '2025-05-01', '2025-06-01', '2025-07-01', '2025-08-01', '2025-09-01', '2025-10-01', '2025-11-01'], 'y': [125595.29, 126471.47, 138298.05, 157464.21, 127879.43, 115270.46, 154703.85, 140281.52, 143798.49, 182479.71, 44141.36], 'hovertemplate': '%{x|%b %Y}<br>Earbuds S: %{y:$,.2f}<extra></extra>'}, {'type': 'scatter', 'mode': 'lines+markers', 'name': 'Phone X1', 'x': ['2025-01-01', '2025-02-01', '2025-03-01', '2025-04-01', '2025-05-01', '2025-06-01', '2025-07-01', '2025-08-01', '2025-09-01', '2025-10-01', '2025-11-01'], 'y': [1573077.31, 1262694.44, 1673363.97, 1737814.4, 1718808.28, 1555253.78, 1813375.84, 1667458.43, 1970471.54, 2194267.35, 549372.76], 'hovertemplate': '%{x|%b %Y}<br>Phone X1: %{y:$,.2f}<extra></extra>'}, {'type': 'scatter', 'mode': 'lines+markers', 'name': 'Phone X1 Pro', 'x': ['2025-01-01', '2025-02-01', '2025-03-01', '2025-04-01', '2025-05-01', '2025-06-01', '2025-07-01', '2025-08-01', '2025-09-01', '2025-10-01', '2025-11-01'], 'y': [2014955.71, 1974660.89, 1873861.08, 2110221.2, 2147613.03, 2072962.45, 2013600.18, 2263577.24, 1926775.19, 2590424.2, 809641.12], 'hovertemplate': '%{x|%b %Y}<br>Phone X1 Pro: %{y:$,.2f}<extra></extra>'}, {'type': 'scatter', 'mode': 'lines+markers', 'name': 'Smartwatch G', 'x': ['2025-01-01', '2025-02-01', '2025-03-01', '2025-04-01', '2025-05-01', '2025-06-01', '2025-07-01', '2025-08-01', '2... (truncated)", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:31:32.132+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"Earbuds S\", \"x\": [\"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [125595.29, 126471.47, 138298.05, 157464.21, 127879.43, 115270.46, 154703.85, 140281.52, 143798.49, 182479.71, 44141.36], \"hovertemplate\": \"%{x|%b %Y}<br>Earbuds S: %{y:$,.2f}<extra></extra>\"}, {\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"Phone X1\", \"x\": [\"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [1573077.31, 1262694.44, 1673363.97, 1737814.4, 1718808.28, 1555253.78, 1813375.84, 1667458.43, 1970471.54, 2194267.35, 549372.76], \"hovertemplate\": \"%{x|%b %Y}<br>Phone X1: %{y:$,.2f}<extra></extra>\"}, {\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"Phone X1 Pro\", \"x\": [\"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [2014955.71, 1974660.89, 1873861.08, 2110221.2, 2147613.03, 2072962.45, 2013600.18, 2263577.24, 1926775.19, 2590424.2, 809641.12], \"hovertemplate\": \"%{x|%b %Y}<br>Phone X1 Pro: %{y:$,.2f}<extra></extra>\"}, {\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"Smartwatch G\", \"x\": [\"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [328570.62, 287932.62, 272551.5, 283199.34, 288533.06, 307888.13, 295604.55, 270322.68, 312217.92, 427934.04, 114331.92], \"hovertemplate\": \"%{x|%b %Y}<br>Smartwatch G: %{y:$,.2f}<extra></extra>\"}, {\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"Laptop Pro 15\", \"x\": [\"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [3206650.15, 2522579.2, 3471580.51, 3211531.07, 3645070.49, 2674968.42, 3451856.97, 3108034.05, 3379587.37, 3860906.26, 1005238.83], \"hovertemplate\": \"%{x|%b %Y}<br>Laptop Pro 15: %{y:$,.2f}<extra></extra>\"}, {\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"Laptop Air 13\", \"x\": [\"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [2063370.33, 2422884.13, 2130011.67, 2354859.91, 2267842.54, 2002484.3, 2326885.78, 2056424.14, 2428223.39, 2976651.97, 741785.97], \"hovertemplate\": \"%{x|%b %Y}<br>Laptop Air 13: %{y:$,.2f}<extra></extra>\"}, {\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"Gaming Mouse Z\", \"x\": [\"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [94807.5, 75399.56, 90560.91, 81381.77, 87253.38, 82661.26, 94294.65, 97053.5, 106596.38, 112142.01, 27726.49], \"hovertemplate\": \"%{x|%b %Y}<br>Gaming Mouse Z: %{y:$,.2f}<extra></extra>\"}, {\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"4K Monitor 27\\\"\", \"x\": [\"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [602988.25, 592505.74, 712525.63, 652552.09, 611152.95, 587312.84, 670535.93, 645778.42, 765128.37, 881619.2, 246963.48], \"hovertemplate\": \"%{x|%b %Y}<br>4K Monitor 27\\\": %{y:$,.2f}<extra></extra>\"}], \"layout\": {\"title\": {\"text\": \"Monthly Revenue by Product in 2025\", \"x\": 0.5}, \"xaxis\": {\"title\": \"Months\", \"type\": \"date\", \"tickformat\": \"%b %Y\"}, \"yaxis\": {\"title\": \"Actual Revenue\", \"tickprefix\": \"$\", \"separatethousands\": true}, \"legend\": {\"orientation\": \"v\", \"x\": 1, \"y\": 1, \"xanchor\": \"left\", \"yanchor\": \"top\"}, \"margin\": {\"l\": 80, \"r\": 200, \"t\": 80, \"b\": 80}, \"hovermode\": \"x unified\"}}", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:31:32.134+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/299dcc77286a.json", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:31:32.141+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:31:32.141+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:31:32.143+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:31:32.149+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:31:32.151+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:31:32.156+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:31:32.157+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:31:32.158+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "Show monthly revenue by product in 2025.", "has_chart": true, "has_narrative": true, "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:31:32.160+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 3888, "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:31:32.160+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 733, "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:31:32.161+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "299dcc77286a"}
{"timestamp": "2025-11-18T00:32:04.940+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "How has total income changed month by month this year?", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:04.947+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:04.960+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:04.965+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=54)", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:04.965+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:09.327+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:09.327+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='How has total income changed month by month this year?', metrics=['actual_revenue'], dimensions=['month'], time_grain='monthly', time_range='this_year', filters=[], sort=None, top_k=None, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['Use a line chart to show actual_revenue over each month of this year.', 'X-axis: month, Y-axis: actual_revenue.', \"Title: 'Monthly Total Income Change This Year'.\"]), chart_figure_json=None, narrative=None)]", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:09.329+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:09.330+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:09.330+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:09.331+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:09.332+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:09.333+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:09.334+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:09.334+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['actual_revenue'] dims=['month']", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:09.335+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:12.260+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4008, "completion_tokens": 156, "total_tokens": 4164, "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:12.260+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=575)", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:12.260+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=575)", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:12.262+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:12.262+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=575):\nWITH base AS (\n  SELECT\n    fact_sales.sale_id,\n    fact_sales.revenue,\n    fact_sales.quantity,\n    fact_sales.unit_price,\n    dim_date.date\n  FROM public.fact_sales\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE date_trunc('year', dim_date.date) = date_trunc('year', CURRENT_DATE)\n),\nagg AS (\n  SELECT\n    date_trunc('month', base.date)::date AS period,\n    SUM(COALESCE(base.revenue, base.quantity * base.unit_price)) AS actual_revenue\n  FROM base\n  GROUP BY 1\n)\nSELECT\n  period,\n  actual_revenue\nFROM agg\nORDER BY period ASC, actual_revenue DESC;", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:12.264+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:12.300+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:12.300+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:12.301+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:12.302+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:12.373+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=11, cols=2)", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:12.373+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=11, cols=2)", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:12.375+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (11, 2)", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:12.376+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:12.378+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: How has total income changed month by month this year?", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:12.378+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['Use a line chart to show actual_revenue over each month of this year.', 'X-axis: month, Y-axis: actual_revenue.', \"Title: 'Monthly Total Income Change This Year'.\"]}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"period\":\"2025-01-01\",\"actual_revenue\":10010015.1600000001},{\"period\":\"2025-02-01\",\"actual_revenue\":9265128.0500000007},{\"period\":\"2025-03-01\",\"actual_revenue\":10362753.3200000003},{\"period\":\"2025-04-01\",\"actual_revenue\":10589023.9900000002},{\"period\":\"2025-05-01\",\"actual_revenue\":10894153.1600000001},{\"period\":\"2025-06-01\",\"actual_revenue\":9398801.6400000006},{\"period\":\"2025-07-01\",\"actual_revenue\":10820857.75},{\"period\":\"2025-08-01\",\"actual_revenue\":10248929.9800000004},{\"period\":\"2025-09-01\",\"actual_revenue\":11839221.5199999996},{\"period\":\"2025-10-01\",\"actual_revenue\":15429808.6999999993},{\"period\":\"2025-11-01\",\"actual_revenue\":4042539.2599999998}]\n```", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:12.378+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=1017)", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:22.501+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 895, "completion_tokens": 575, "total_tokens": 1470, "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:22.501+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=1919)", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:22.503+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:22.503+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=808):\n{'data': [{'type': 'scatter', 'mode': 'lines+markers', 'x': ['2025-01-01', '2025-02-01', '2025-03-01', '2025-04-01', '2025-05-01', '2025-06-01', '2025-07-01', '2025-08-01', '2025-09-01', '2025-10-01', '2025-11-01'], 'y': [10010015.16, 9265128.05, 10362753.32, 10589023.99, 10894153.16, 9398801.64, 10820857.75, 10248929.98, 11839221.52, 15429808.7, 4042539.26], 'name': 'actual_revenue', 'line': {'color': '#1f77b4'}, 'marker': {'color': '#1f77b4'}}], 'layout': {'title': {'text': 'Monthly Total Income Change This Year', 'x': 0.5, 'xanchor': 'center'}, 'xaxis': {'title': 'month', 'type': 'date', 'tickformat': '%b', 'dtick': 'M1'}, 'yaxis': {'title': 'actual_revenue', 'tickformat': ',.0f'}, 'legend': {'x': 1, 'y': 1, 'xanchor': 'right', 'yanchor': 'top'}, 'margin': {'l': 60, 'r': 40, 't': 60, 'b': 60}}}", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:22.504+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"scatter\", \"mode\": \"lines+markers\", \"x\": [\"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [10010015.16, 9265128.05, 10362753.32, 10589023.99, 10894153.16, 9398801.64, 10820857.75, 10248929.98, 11839221.52, 15429808.7, 4042539.26], \"name\": \"actual_revenue\", \"line\": {\"color\": \"#1f77b4\"}, \"marker\": {\"color\": \"#1f77b4\"}}], \"layout\": {\"title\": {\"text\": \"Monthly Total Income Change This Year\", \"x\": 0.5, \"xanchor\": \"center\"}, \"xaxis\": {\"title\": \"month\", \"type\": \"date\", \"tickformat\": \"%b\", \"dtick\": \"M1\"}, \"yaxis\": {\"title\": \"actual_revenue\", \"tickformat\": \",.0f\"}, \"legend\": {\"x\": 1, \"y\": 1, \"xanchor\": \"right\", \"yanchor\": \"top\"}, \"margin\": {\"l\": 60, \"r\": 40, \"t\": 60, \"b\": 60}}}", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:22.506+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/4234a10fc926.json", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:22.513+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:22.513+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:22.515+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:22.518+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:22.519+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:22.522+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:22.523+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:22.523+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "How has total income changed month by month this year?", "has_chart": true, "has_narrative": true, "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:22.525+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 808, "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:22.526+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 485, "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:22.526+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "4234a10fc926"}
{"timestamp": "2025-11-18T00:32:38.208+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "Show revenue versus budgeted revenue by region.", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:38.213+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:38.224+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:38.229+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=47)", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:38.229+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:41.673+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:41.673+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='Show revenue versus budgeted revenue by region.', metrics=['actual_revenue', 'budget_revenue'], dimensions=['region'], time_grain='AllPeriods', time_range='past_3_years', filters=[], sort=None, top_k=None, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['Use a bar chart to compare actual revenue and budgeted revenue by region.', 'Group data by region on the x-axis.', 'Show two bars per region: one for actual revenue and one for budgeted revenue.', 'Include a legend to distinguish actual revenue and budgeted revenue.']), chart_figure_json=None, narrative=None)]", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:41.677+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:41.677+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:41.679+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:41.679+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:41.681+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:41.682+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:41.683+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:41.683+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['actual_revenue', 'budget_revenue'] dims=['region']", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:41.684+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:47.014+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4015, "completion_tokens": 193, "total_tokens": 4208, "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:47.015+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=730)", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:47.015+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=730)", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:47.017+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:47.017+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=730):\nWITH base AS (\n  SELECT\n    fact_sales.revenue,\n    fact_sales.quantity,\n    fact_sales.unit_price,\n    fact_sales.budget_revenue,\n    fact_sales.sales_cost,\n    dim_region.region_name\n  FROM public.fact_sales\n  JOIN public.dim_region ON fact_sales.region_sk = dim_region.region_sk\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE dim_date.date >= make_date(extract(year from current_date)::int - 2, 1, 1)\n),\nagg AS (\n  SELECT\n    region_name,\n    SUM(COALESCE(base.revenue, base.quantity * base.unit_price)) AS actual_revenue,\n    SUM(base.budget_revenue) AS budget_revenue\n  FROM base\n  GROUP BY 1\n)\nSELECT\n  region_name AS region,\n  actual_revenue,\n  budget_revenue\nFROM agg\nORDER BY actual_revenue DESC;", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:47.018+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:47.045+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:47.046+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:47.047+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:47.047+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:47.118+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=4, cols=3)", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:47.118+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=4, cols=3)", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:47.120+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (4, 3)", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:47.121+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:47.123+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: Show revenue versus budgeted revenue by region.", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:47.123+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['Use a bar chart to compare actual revenue and budgeted revenue by region.', 'Group data by region on the x-axis.', 'Show two bars per region: one for actual revenue and one for budgeted revenue.', 'Include a legend to distinguish actual revenue and budgeted revenue.']}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"region\":\"ANZ\",\"actual_revenue\":37213333.1199999973,\"budget_revenue\":35732844.0},{\"region\":\"APAC\",\"actual_revenue\":37105031.7599999979,\"budget_revenue\":35560659.0},{\"region\":\"AMER\",\"actual_revenue\":37090487.8999999985,\"budget_revenue\":35822701.0},{\"region\":\"EMEA\",\"actual_revenue\":35205353.700000003,\"budget_revenue\":33982845.0}]\n```", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:47.123+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=791)", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:55.829+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 783, "completion_tokens": 475, "total_tokens": 1258, "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:55.830+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=1575)", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:55.831+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:55.831+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=617):\n{'data': [{'type': 'bar', 'x': ['ANZ', 'APAC', 'AMER', 'EMEA'], 'y': [37213333.12, 37105031.76, 37090487.9, 35205353.7], 'name': 'Actual Revenue', 'marker': {'color': '#1f77b4'}}, {'type': 'bar', 'x': ['ANZ', 'APAC', 'AMER', 'EMEA'], 'y': [35732844, 35560659, 35822701, 33982845], 'name': 'Budgeted Revenue', 'marker': {'color': '#ff7f0e'}}], 'layout': {'barmode': 'group', 'xaxis': {'title': 'Region', 'type': 'category'}, 'yaxis': {'title': 'Revenue', 'tickformat': ',.0f'}, 'legend': {'x': 1, 'y': 1, 'xanchor': 'right', 'yanchor': 'top'}, 'margin': {'t': 40, 'b': 40, 'l': 60, 'r': 40}, 'hovermode': 'x unified'}}", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:55.832+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"bar\", \"x\": [\"ANZ\", \"APAC\", \"AMER\", \"EMEA\"], \"y\": [37213333.12, 37105031.76, 37090487.9, 35205353.7], \"name\": \"Actual Revenue\", \"marker\": {\"color\": \"#1f77b4\"}}, {\"type\": \"bar\", \"x\": [\"ANZ\", \"APAC\", \"AMER\", \"EMEA\"], \"y\": [35732844, 35560659, 35822701, 33982845], \"name\": \"Budgeted Revenue\", \"marker\": {\"color\": \"#ff7f0e\"}}], \"layout\": {\"barmode\": \"group\", \"xaxis\": {\"title\": \"Region\", \"type\": \"category\"}, \"yaxis\": {\"title\": \"Revenue\", \"tickformat\": \",.0f\"}, \"legend\": {\"x\": 1, \"y\": 1, \"xanchor\": \"right\", \"yanchor\": \"top\"}, \"margin\": {\"t\": 40, \"b\": 40, \"l\": 60, \"r\": 40}, \"hovermode\": \"x unified\"}}", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:55.832+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/0b9085b7c969.json", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:55.836+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:55.836+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:55.838+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:55.841+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:55.843+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:55.847+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:55.849+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:55.849+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "Show revenue versus budgeted revenue by region.", "has_chart": true, "has_narrative": true, "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:55.851+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 617, "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:55.852+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 656, "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:32:55.852+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "0b9085b7c969"}
{"timestamp": "2025-11-18T00:33:08.241+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "What are the top 10 products by income in the past 30 days?", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:08.246+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:08.256+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:08.260+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=59)", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:08.260+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:11.398+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:11.398+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='What are the top 10 products by income in the past 30 days?', metrics=['actual_revenue'], dimensions=['product'], time_grain='AllPeriods', time_range='past_30_days', filters=[], sort='-actual_revenue', top_k=10, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['bar chart', 'show top 10 products by actual revenue', 'sort bars descending by actual revenue', 'x-axis: product', 'y-axis: actual revenue', 'title: Top 10 Products by Income in the Past 30 Days']), chart_figure_json=None, narrative=None)]", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:11.400+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:11.400+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:11.401+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:11.402+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:11.404+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:11.405+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:11.406+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:11.406+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['actual_revenue'] dims=['product']", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:11.407+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:15.442+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4017, "completion_tokens": 156, "total_tokens": 4173, "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:15.443+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=608)", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:15.443+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=608)", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:15.443+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:15.443+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=608):\nWITH base AS (\n  SELECT\n    fact_sales.product_sk,\n    dim_product.product_name,\n    COALESCE(fact_sales.revenue, fact_sales.quantity * fact_sales.unit_price) AS actual_revenue\n  FROM public.fact_sales\n  JOIN public.dim_product ON fact_sales.product_sk = dim_product.product_sk\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE dim_date.date >= CURRENT_DATE - interval '30 days'\n)\n, agg AS (\n  SELECT\n    product_name,\n    SUM(actual_revenue) AS actual_revenue\n  FROM base\n  GROUP BY 1\n)\nSELECT\n  product_name AS product,\n  actual_revenue\nFROM agg\nORDER BY actual_revenue DESC\nLIMIT 10;", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:15.444+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:15.463+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:15.463+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:15.464+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:15.464+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:15.512+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=10, cols=2)", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:15.512+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=10, cols=2)", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:15.513+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (10, 2)", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:15.513+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:15.514+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: What are the top 10 products by income in the past 30 days?", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:15.514+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['bar chart', 'show top 10 products by actual revenue', 'sort bars descending by actual revenue', 'x-axis: product', 'y-axis: actual revenue', 'title: Top 10 Products by Income in the Past 30 Days']}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"product\":\"Laptop Pro 15\",\"actual_revenue\":2666574.9300000002},{\"product\":\"Laptop Air 13\",\"actual_revenue\":1973071.6100000001},{\"product\":\"Phone X1 Pro\",\"actual_revenue\":1903460.25},{\"product\":\"Phone X1\",\"actual_revenue\":1479121.5},{\"product\":\"4K Monitor 27\\\"\",\"actual_revenue\":606859.49},{\"product\":\"All Products Electronics\",\"actual_revenue\":458813.56},{\"product\":\"All Products Computers\",\"actual_revenue\":310837.28},{\"product\":\"Smartwatch G\",\"actual_revenue\":304395.34},{\"product\":\"All Products Peripherals\",\"actual_revenue\":284719.37},{\"product\":\"All Products Accessories\",\"actual_revenue\":257869.93}]\n```", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:15.514+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=995)", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:26.809+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 832, "completion_tokens": 670, "total_tokens": 1502, "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:26.809+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=2523)", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:26.811+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:26.811+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=1108):\n{'data': [{'type': 'bar', 'x': ['Laptop Pro 15', 'Laptop Air 13', 'Phone X1 Pro', 'Phone X1', '4K Monitor 27\"', 'All Products Electronics', 'All Products Computers', 'Smartwatch G', 'All Products Peripherals', 'All Products Accessories'], 'y': [2666574.93, 1973071.61, 1903460.25, 1479121.5, 606859.49, 458813.56, 310837.28, 304395.34, 284719.37, 257869.93], 'marker': {'color': 'rgba(31,119,180,0.8)'}, 'hovertemplate': '%{x}<br>Actual Revenue: %{y:$,.2f}<extra></extra>', 'name': 'Actual Revenue'}], 'layout': {'title': {'text': 'Top 10 Products by Income in the Past 30 Days', 'x': 0.5, 'xanchor': 'center'}, 'xaxis': {'title': 'Product', 'categoryorder': 'array', 'categoryarray': ['Laptop Pro 15', 'Laptop Air 13', 'Phone X1 Pro', 'Phone X1', '4K Monitor 27\"', 'All Products Electronics', 'All Products Computers', 'Smartwatch G', 'All Products Peripherals', 'All Products Accessories'], 'tickangle': -45}, 'yaxis': {'title': 'Actual Revenue', 'tickformat': '$,.0f'}, 'legend': {'orientation': 'v', 'x': 1, 'y': 1, 'xanchor': 'left', 'yanchor': 'top'}, 'margin': {'t': 60, 'b': 120, 'l': 80, 'r': 150}}}", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:26.811+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"bar\", \"x\": [\"Laptop Pro 15\", \"Laptop Air 13\", \"Phone X1 Pro\", \"Phone X1\", \"4K Monitor 27\\\"\", \"All Products Electronics\", \"All Products Computers\", \"Smartwatch G\", \"All Products Peripherals\", \"All Products Accessories\"], \"y\": [2666574.93, 1973071.61, 1903460.25, 1479121.5, 606859.49, 458813.56, 310837.28, 304395.34, 284719.37, 257869.93], \"marker\": {\"color\": \"rgba(31,119,180,0.8)\"}, \"hovertemplate\": \"%{x}<br>Actual Revenue: %{y:$,.2f}<extra></extra>\", \"name\": \"Actual Revenue\"}], \"layout\": {\"title\": {\"text\": \"Top 10 Products by Income in the Past 30 Days\", \"x\": 0.5, \"xanchor\": \"center\"}, \"xaxis\": {\"title\": \"Product\", \"categoryorder\": \"array\", \"categoryarray\": [\"Laptop Pro 15\", \"Laptop Air 13\", \"Phone X1 Pro\", \"Phone X1\", \"4K Monitor 27\\\"\", \"All Products Electronics\", \"All Products Computers\", \"Smartwatch G\", \"All Products Peripherals\", \"All Products Accessories\"], \"tickangle\": -45}, \"yaxis\": {\"title\": \"Actual Revenue\", \"tickformat\": \"$,.0f\"}, \"legend\": {\"orientation\": \"v\", \"x\": 1, \"y\": 1, \"xanchor\": \"left\", \"yanchor\": \"top\"}, \"margin\": {\"t\": 60, \"b\": 120, \"l\": 80, \"r\": 150}}}", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:26.814+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/13109e03fb60.json", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:26.821+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:26.821+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:26.823+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:26.825+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:26.827+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:26.829+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:26.831+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:26.831+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "What are the top 10 products by income in the past 30 days?", "has_chart": true, "has_narrative": true, "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:26.833+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 1110, "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:26.834+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 716, "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:26.834+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "13109e03fb60"}
{"timestamp": "2025-11-18T00:33:47.070+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "Show profit margins by product category for last month.", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:47.075+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:47.086+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:47.090+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=55)", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:47.090+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:49.622+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:49.623+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='Show profit margins by product category for last month.', metrics=['gross_margin'], dimensions=['product_category'], time_grain='AllPeriods', time_range='last_month', filters=[], sort=None, top_k=None, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['Use a bar chart to show gross margin by product category for last month.', 'X-axis: product category.', 'Y-axis: gross margin.', 'Title: Profit Margins by Product Category for Last Month.']), chart_figure_json=None, narrative=None)]", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:49.625+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:49.625+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:49.625+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:49.626+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:49.627+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:49.628+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:49.629+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:49.630+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['gross_margin'] dims=['product_category']", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:49.631+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:54.457+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4008, "completion_tokens": 170, "total_tokens": 4178, "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:54.457+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=655)", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:54.457+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=655)", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:54.458+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:54.458+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=655):\nWITH base AS (\n  SELECT\n    dim_product.category AS product_category,\n    (COALESCE(fact_sales.revenue, fact_sales.quantity * fact_sales.unit_price) - COALESCE(fact_sales.sales_cost, 0)) AS gross_margin\n  FROM public.fact_sales\n  JOIN public.dim_product ON fact_sales.product_sk = dim_product.product_sk\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE date_trunc('month', dim_date.date) = date_trunc('month', CURRENT_DATE) - interval '1 month'\n)\n, agg AS (\n  SELECT\n    product_category,\n    SUM(gross_margin) AS gross_margin\n  FROM base\n  GROUP BY 1\n)\nSELECT\n  product_category,\n  gross_margin\nFROM agg\nORDER BY gross_margin DESC;", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:54.459+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:54.481+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:54.481+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:54.481+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:54.482+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:54.535+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=5, cols=2)", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:54.535+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=5, cols=2)", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:54.536+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (5, 2)", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:54.536+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:54.537+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: Show profit margins by product category for last month.", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:54.537+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['Use a bar chart to show gross margin by product category for last month.', 'X-axis: product category.', 'Y-axis: gross margin.', 'Title: Profit Margins by Product Category for Last Month.']}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"product_category\":\"Computers\",\"gross_margin\":7333504.2000000002},{\"product_category\":\"Electronics\",\"gross_margin\":5312513.7699999996},{\"product_category\":\"Peripherals\",\"gross_margin\":1387073.3200000001},{\"product_category\":\"Wearables\",\"gross_margin\":770904.0699999999},{\"product_category\":\"Accessories\",\"gross_margin\":580286.0}]\n```", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:33:54.537+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=712)", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:34:01.521+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 742, "completion_tokens": 387, "total_tokens": 1129, "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:34:01.522+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=1362)", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:34:01.523+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:34:01.523+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=582):\n{'data': [{'type': 'bar', 'x': ['Computers', 'Electronics', 'Peripherals', 'Wearables', 'Accessories'], 'y': [7333504.2, 5312513.77, 1387073.32, 770904.07, 580286], 'marker': {'color': 'rgba(31,119,180,0.8)'}, 'name': 'Gross Margin'}], 'layout': {'title': {'text': 'Profit Margins by Product Category for Last Month', 'x': 0.5, 'xanchor': 'center'}, 'xaxis': {'title': 'Product Category', 'type': 'category'}, 'yaxis': {'title': 'Gross Margin', 'tickformat': ',.0f'}, 'legend': {'x': 1, 'y': 1, 'xanchor': 'right', 'yanchor': 'top'}, 'margin': {'t': 50, 'b': 50, 'l': 70, 'r': 50}}}", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:34:01.524+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"bar\", \"x\": [\"Computers\", \"Electronics\", \"Peripherals\", \"Wearables\", \"Accessories\"], \"y\": [7333504.2, 5312513.77, 1387073.32, 770904.07, 580286], \"marker\": {\"color\": \"rgba(31,119,180,0.8)\"}, \"name\": \"Gross Margin\"}], \"layout\": {\"title\": {\"text\": \"Profit Margins by Product Category for Last Month\", \"x\": 0.5, \"xanchor\": \"center\"}, \"xaxis\": {\"title\": \"Product Category\", \"type\": \"category\"}, \"yaxis\": {\"title\": \"Gross Margin\", \"tickformat\": \",.0f\"}, \"legend\": {\"x\": 1, \"y\": 1, \"xanchor\": \"right\", \"yanchor\": \"top\"}, \"margin\": {\"t\": 50, \"b\": 50, \"l\": 70, \"r\": 50}}}", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:34:01.525+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/4252892a2973.json", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:34:01.528+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:34:01.529+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:34:01.530+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:34:01.533+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:34:01.535+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:34:01.538+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:34:01.540+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:34:01.540+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "Show profit margins by product category for last month.", "has_chart": true, "has_narrative": true, "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:34:01.543+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 582, "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:34:01.543+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 446, "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:34:01.543+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "4252892a2973"}
{"timestamp": "2025-11-18T00:34:17.982+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "Show monthly income trends for 2025.", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:17.987+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:17.998+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:18.002+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=36)", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:18.002+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:20.985+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:20.985+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='Show monthly income trends for 2025.', metrics=['actual_revenue'], dimensions=['month'], time_grain='monthly', time_range='past_3_years', filters=[Filter(field='year', op='=', value=2025)], sort=None, top_k=None, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['Use a line chart to show monthly trends of actual revenue for the year 2025.', 'X-axis: month, Y-axis: actual revenue.', 'Title: Monthly Income Trends for 2025.']), chart_figure_json=None, narrative=None)]", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:20.987+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:20.988+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:20.989+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:20.989+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:20.991+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:20.992+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:20.993+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:20.994+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['actual_revenue'] dims=['month']", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:20.994+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:25.494+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4015, "completion_tokens": 234, "total_tokens": 4249, "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:25.494+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=884)", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:25.495+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=884)", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:25.496+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:25.497+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=884):\nWITH base AS (\n  SELECT\n    fact_sales.sale_id,\n    fact_sales.product_sk,\n    fact_sales.date_sk,\n    fact_sales.customer_sk,\n    fact_sales.salesperson_sk,\n    fact_sales.region_sk,\n    fact_sales.quantity,\n    fact_sales.unit_price,\n    fact_sales.revenue,\n    fact_sales.sales_cost,\n    fact_sales.budget_revenue,\n    dim_date.date,\n    dim_date.year,\n    COALESCE(fact_sales.revenue, fact_sales.quantity * fact_sales.unit_price) AS actual_revenue\n  FROM public.fact_sales\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE dim_date.date >= make_date(extract(year from current_date)::int - 2, 1, 1)\n    AND dim_date.year = 2025\n),\nagg AS (\n  SELECT\n    date_trunc('month', base.date)::date AS period,\n    SUM(base.actual_revenue) AS actual_revenue\n  FROM base\n  GROUP BY 1\n)\nSELECT\n  period,\n  actual_revenue\nFROM agg\nORDER BY actual_revenue DESC, period ASC;", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:25.498+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:25.529+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:25.529+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:25.531+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:25.531+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:25.606+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=11, cols=2)", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:25.606+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=11, cols=2)", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:25.609+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (11, 2)", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:25.610+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:25.612+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: Show monthly income trends for 2025.", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:25.612+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['Use a line chart to show monthly trends of actual revenue for the year 2025.', 'X-axis: month, Y-axis: actual revenue.', 'Title: Monthly Income Trends for 2025.']}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"period\":\"2025-01-01\",\"actual_revenue\":10010015.1600000001},{\"period\":\"2025-02-01\",\"actual_revenue\":9265128.0500000007},{\"period\":\"2025-03-01\",\"actual_revenue\":10362753.3200000003},{\"period\":\"2025-04-01\",\"actual_revenue\":10589023.9900000002},{\"period\":\"2025-05-01\",\"actual_revenue\":10894153.1600000001},{\"period\":\"2025-06-01\",\"actual_revenue\":9398801.6400000006},{\"period\":\"2025-07-01\",\"actual_revenue\":10820857.75},{\"period\":\"2025-08-01\",\"actual_revenue\":10248929.9800000004},{\"period\":\"2025-09-01\",\"actual_revenue\":11839221.5199999996},{\"period\":\"2025-10-01\",\"actual_revenue\":15429808.6999999993},{\"period\":\"2025-11-01\",\"actual_revenue\":4042539.2599999998}]\n```", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:25.612+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=1015)", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:33.678+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 896, "completion_tokens": 555, "total_tokens": 1451, "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:33.679+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=1829)", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:33.680+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:33.681+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=780):\n{'data': [{'type': 'scatter', 'mode': 'lines+markers', 'x': ['2025-01-01', '2025-02-01', '2025-03-01', '2025-04-01', '2025-05-01', '2025-06-01', '2025-07-01', '2025-08-01', '2025-09-01', '2025-10-01', '2025-11-01'], 'y': [10010015.16, 9265128.05, 10362753.32, 10589023.99, 10894153.16, 9398801.64, 10820857.75, 10248929.98, 11839221.52, 15429808.7, 4042539.26], 'name': 'Actual Revenue', 'line': {'color': '#1f77b4'}, 'marker': {'color': '#1f77b4'}}], 'layout': {'title': {'text': 'Monthly Income Trends for 2025', 'x': 0.5}, 'xaxis': {'title': 'Month', 'type': 'date', 'tickformat': '%b', 'dtick': 'M1'}, 'yaxis': {'title': 'Actual Revenue', 'tickformat': ',.0f'}, 'legend': {'x': 1, 'y': 1, 'xanchor': 'right', 'yanchor': 'top'}, 'margin': {'l': 60, 'r': 40, 't': 60, 'b': 60}}}", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:33.681+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"scatter\", \"mode\": \"lines+markers\", \"x\": [\"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [10010015.16, 9265128.05, 10362753.32, 10589023.99, 10894153.16, 9398801.64, 10820857.75, 10248929.98, 11839221.52, 15429808.7, 4042539.26], \"name\": \"Actual Revenue\", \"line\": {\"color\": \"#1f77b4\"}, \"marker\": {\"color\": \"#1f77b4\"}}], \"layout\": {\"title\": {\"text\": \"Monthly Income Trends for 2025\", \"x\": 0.5}, \"xaxis\": {\"title\": \"Month\", \"type\": \"date\", \"tickformat\": \"%b\", \"dtick\": \"M1\"}, \"yaxis\": {\"title\": \"Actual Revenue\", \"tickformat\": \",.0f\"}, \"legend\": {\"x\": 1, \"y\": 1, \"xanchor\": \"right\", \"yanchor\": \"top\"}, \"margin\": {\"l\": 60, \"r\": 40, \"t\": 60, \"b\": 60}}}", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:33.683+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/48e8916662b5.json", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:33.687+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:33.688+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:33.690+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:33.693+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:33.696+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:33.699+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:33.700+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:33.700+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "Show monthly income trends for 2025.", "has_chart": true, "has_narrative": true, "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:33.703+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 780, "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:33.703+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 431, "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:33.703+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "48e8916662b5"}
{"timestamp": "2025-11-18T00:34:45.936+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "Compare revenue across regions for the last quarter.", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:45.941+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:45.952+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:45.956+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=52)", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:45.956+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:48.623+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:48.623+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='Compare revenue across regions for the last quarter.', metrics=['actual_revenue'], dimensions=['region'], time_grain='AllPeriods', time_range='past_90_days', filters=[Filter(field='quarter', op='=', value='last_quarter')], sort=None, top_k=None, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['Use a bar chart to compare actual revenue across regions for the last quarter.', 'Regions on the x-axis and actual revenue on the y-axis.', \"Title the chart 'Revenue Comparison by Region for Last Quarter'.\"]), chart_figure_json=None, narrative=None)]", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:48.626+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:48.626+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:48.627+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:48.628+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:48.630+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:48.631+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:48.631+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:48.632+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['actual_revenue'] dims=['region']", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:48.633+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:52.200+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4016, "completion_tokens": 190, "total_tokens": 4206, "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:52.201+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=744)", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:52.201+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=744)", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:52.203+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:52.203+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=744):\nWITH base AS (\n  SELECT\n    fact_sales.revenue,\n    fact_sales.quantity,\n    fact_sales.unit_price,\n    fact_sales.sales_cost,\n    fact_sales.budget_revenue,\n    dim_region.region_name\n  FROM public.fact_sales\n  JOIN public.dim_region ON fact_sales.region_sk = dim_region.region_sk\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE dim_date.date >= CURRENT_DATE - interval '90 days'\n    AND date_trunc('quarter', dim_date.date) = date_trunc('quarter', CURRENT_DATE - interval '3 month')\n),\nagg AS (\n  SELECT\n    region_name,\n    SUM(COALESCE(base.revenue, base.quantity * base.unit_price)) AS actual_revenue\n  FROM base\n  GROUP BY 1\n)\nSELECT\n  region_name AS region,\n  actual_revenue\nFROM agg\nORDER BY actual_revenue DESC;", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:52.206+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:52.242+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:52.242+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:52.243+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:52.244+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:52.304+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=4, cols=2)", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:52.304+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=4, cols=2)", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:52.306+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (4, 2)", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:52.307+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:52.308+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: Compare revenue across regions for the last quarter.", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:52.309+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['Use a bar chart to compare actual revenue across regions for the last quarter.', 'Regions on the x-axis and actual revenue on the y-axis.', \"Title the chart 'Revenue Comparison by Region for Last Quarter'.\"]}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"region\":\"ANZ\",\"actual_revenue\":4004128.5499999998},{\"region\":\"APAC\",\"actual_revenue\":3938281.21},{\"region\":\"EMEA\",\"actual_revenue\":3905258.2200000002},{\"region\":\"AMER\",\"actual_revenue\":3692246.3199999998}]\n```", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:52.309+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=607)", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:58.565+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 727, "completion_tokens": 388, "total_tokens": 1115, "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:58.565+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=1364)", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:58.567+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:58.567+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=513):\n{'data': [{'type': 'bar', 'x': ['ANZ', 'APAC', 'EMEA', 'AMER'], 'y': [4004128.55, 3938281.21, 3905258.22, 3692246.32], 'name': 'Actual Revenue', 'marker': {'color': '#1f77b4'}}], 'layout': {'title': {'text': 'Revenue Comparison by Region for Last Quarter', 'x': 0.5, 'xanchor': 'center'}, 'xaxis': {'title': 'Region', 'type': 'category'}, 'yaxis': {'title': 'Actual Revenue', 'tickformat': ',.0f'}, 'legend': {'x': 1, 'y': 1, 'xanchor': 'right', 'yanchor': 'top'}, 'margin': {'l': 60, 'r': 40, 't': 60, 'b': 60}}}", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:58.567+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"bar\", \"x\": [\"ANZ\", \"APAC\", \"EMEA\", \"AMER\"], \"y\": [4004128.55, 3938281.21, 3905258.22, 3692246.32], \"name\": \"Actual Revenue\", \"marker\": {\"color\": \"#1f77b4\"}}], \"layout\": {\"title\": {\"text\": \"Revenue Comparison by Region for Last Quarter\", \"x\": 0.5, \"xanchor\": \"center\"}, \"xaxis\": {\"title\": \"Region\", \"type\": \"category\"}, \"yaxis\": {\"title\": \"Actual Revenue\", \"tickformat\": \",.0f\"}, \"legend\": {\"x\": 1, \"y\": 1, \"xanchor\": \"right\", \"yanchor\": \"top\"}, \"margin\": {\"l\": 60, \"r\": 40, \"t\": 60, \"b\": 60}}}", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:58.568+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/6038866aab66.json", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:58.573+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:58.573+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:58.575+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:58.579+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:58.580+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:58.583+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:58.584+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:58.585+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "Compare revenue across regions for the last quarter.", "has_chart": true, "has_narrative": true, "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:58.587+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 513, "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:58.587+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 517, "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:34:58.587+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "6038866aab66"}
{"timestamp": "2025-11-18T00:35:13.946+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "Which region sold the most units this month?", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:13.951+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:13.962+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:13.966+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=44)", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:13.966+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:16.499+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:16.499+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='Which region sold the most units this month?', metrics=['units_sold'], dimensions=['region'], time_grain='AllPeriods', time_range='this_month', filters=[], sort='-units_sold', top_k=1, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['Bar chart showing units sold by region for this month.', 'Sort regions descending by units sold.', 'Highlight the top region with the highest units sold.', 'X-axis: region, Y-axis: units sold.', \"Title: 'Top Region by Units Sold This Month'\"]), chart_figure_json=None, narrative=None)]", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:16.502+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:16.502+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:16.503+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:16.504+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:16.506+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:16.506+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:16.507+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:16.508+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['units_sold'] dims=['region']", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:16.508+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:19.176+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4007, "completion_tokens": 149, "total_tokens": 4156, "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:19.176+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=555)", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:19.176+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=555)", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:19.178+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:19.178+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=555):\nWITH base AS (\n  SELECT\n    fact_sales.quantity AS quantity,\n    dim_region.region_name AS region_name,\n    dim_date.date AS date\n  FROM public.fact_sales\n  JOIN public.dim_region ON fact_sales.region_sk = dim_region.region_sk\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE date_trunc('month', dim_date.date) = date_trunc('month', CURRENT_DATE)\n)\n, agg AS (\n  SELECT\n    region_name,\n    SUM(quantity) AS units_sold\n  FROM base\n  GROUP BY 1\n)\nSELECT\n  region_name AS region,\n  units_sold\nFROM agg\nORDER BY units_sold DESC\nLIMIT 1;", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:19.180+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:19.210+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:19.210+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:19.212+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:19.213+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:19.273+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=1, cols=2)", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:19.274+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=1, cols=2)", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:19.275+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (1, 2)", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:19.276+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:19.278+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: Which region sold the most units this month?", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:19.278+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['Bar chart showing units sold by region for this month.', 'Sort regions descending by units sold.', 'Highlight the top region with the highest units sold.', 'X-axis: region, Y-axis: units sold.', \"Title: 'Top Region by Units Sold This Month'\"]}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"region\":\"AMER\",\"units_sold\":1890}]\n```", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:19.278+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=471)", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:24.880+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 682, "completion_tokens": 329, "total_tokens": 1011, "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:24.880+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=1108)", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:24.882+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:24.882+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=468):\n{'data': [{'type': 'bar', 'x': ['AMER'], 'y': [1890], 'marker': {'color': ['#EF553B']}, 'name': 'AMER', 'hovertemplate': 'Region: AMER<br>Units Sold: 1890<extra></extra>'}], 'layout': {'title': {'text': 'Top Region by Units Sold This Month', 'x': 0.5}, 'xaxis': {'title': 'region', 'categoryorder': 'total descending'}, 'yaxis': {'title': 'units sold'}, 'legend': {'x': 1, 'y': 1, 'xanchor': 'right', 'yanchor': 'top'}, 'margin': {'t': 50, 'b': 40, 'l': 40, 'r': 40}}}", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:24.882+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"bar\", \"x\": [\"AMER\"], \"y\": [1890], \"marker\": {\"color\": [\"#EF553B\"]}, \"name\": \"AMER\", \"hovertemplate\": \"Region: AMER<br>Units Sold: 1890<extra></extra>\"}], \"layout\": {\"title\": {\"text\": \"Top Region by Units Sold This Month\", \"x\": 0.5}, \"xaxis\": {\"title\": \"region\", \"categoryorder\": \"total descending\"}, \"yaxis\": {\"title\": \"units sold\"}, \"legend\": {\"x\": 1, \"y\": 1, \"xanchor\": \"right\", \"yanchor\": \"top\"}, \"margin\": {\"t\": 50, \"b\": 40, \"l\": 40, \"r\": 40}}}", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:24.884+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/70be6b2b409c.json", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:24.887+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:24.888+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:24.891+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:24.895+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:24.896+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:24.899+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:24.900+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:24.901+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "Which region sold the most units this month?", "has_chart": true, "has_narrative": true, "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:24.902+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 468, "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:24.903+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 314, "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:24.903+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "70be6b2b409c"}
{"timestamp": "2025-11-18T00:35:32.824+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "How have regional sales trended over the last 12 months?", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:32.827+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:32.837+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:32.841+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=56)", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:32.841+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:36.339+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:36.339+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='How have regional sales trended over the last 12 months?', metrics=['sales'], dimensions=['region', 'month'], time_grain='monthly', time_range='past_12_months', filters=[], sort=None, top_k=None, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['Use a line chart to show sales trend over time.', 'X-axis: month (last 12 months).', 'Y-axis: sales metric.', 'Multiple lines, one per region.', 'Include legend for regions.', 'Format X-axis as month-year (e.g., Jan 2023).']), chart_figure_json=None, narrative=None)]", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:36.344+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:36.345+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:36.347+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:36.347+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:36.349+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:36.349+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:36.350+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:36.351+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['sales'] dims=['region', 'month']", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:36.352+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:39.171+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4012, "completion_tokens": 181, "total_tokens": 4193, "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:39.172+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=696)", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:39.172+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=696)", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:39.174+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:39.174+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=696):\nWITH base AS (\n  SELECT\n    fact_sales.region_sk,\n    dim_region.region_name,\n    dim_date.date,\n    COALESCE(fact_sales.revenue, fact_sales.quantity * fact_sales.unit_price) AS actual_revenue\n  FROM public.fact_sales\n  JOIN public.dim_region ON fact_sales.region_sk = dim_region.region_sk\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE dim_date.date >= CURRENT_DATE - interval '12 months'\n),\nagg AS (\n  SELECT\n    date_trunc('month', base.date)::date AS period,\n    base.region_name,\n    SUM(base.actual_revenue) AS actual_revenue\n  FROM base\n  GROUP BY 1, 2\n)\nSELECT\n  period,\n  region_name AS region,\n  actual_revenue AS sales\nFROM agg\nORDER BY period ASC, region ASC;", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:39.176+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:39.210+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:39.210+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:39.211+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:39.212+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:39.289+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=52, cols=3)", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:39.290+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=52, cols=3)", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:39.293+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (52, 3)", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:39.294+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:39.297+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: How have regional sales trended over the last 12 months?", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:39.297+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['Use a line chart to show sales trend over time.', 'X-axis: month (last 12 months).', 'Y-axis: sales metric.', 'Multiple lines, one per region.', 'Include legend for regions.', 'Format X-axis as month-year (e.g., Jan 2023).']}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"period\":\"2024-11-01\",\"region\":\"AMER\",\"sales\":1258032.4399999999},{\"period\":\"2024-11-01\",\"region\":\"ANZ\",\"sales\":876639.26},{\"period\":\"2024-11-01\",\"region\":\"APAC\",\"sales\":1125428.8100000001},{\"period\":\"2024-11-01\",\"region\":\"EMEA\",\"sales\":1295948.8799999999},{\"period\":\"2024-12-01\",\"region\":\"AMER\",\"sales\":2963555.4399999999},{\"period\":\"2024-12-01\",\"region\":\"ANZ\",\"sales\":2668763.6600000001},{\"period\":\"2024-12-01\",\"region\":\"APAC\",\"sales\":2669904.8300000001},{\"period\":\"2024-12-01\",\"region\":\"EMEA\",\"sales\":2426443.1800000002},{\"period\":\"2025-01-01\",\"region\":\"AMER\",\"sales\":2163861.3500000001},{\"period\":\"2025-01-01\",\"region\":\"ANZ\",\"sales\":2537243.0},{\"period\":\"2025-01-01\",\"region\":\"APAC\",\"sales\":2548097.8100000001},{\"period\":\"2025-01-01\",\"region\":\"EMEA\",\"sales\":2760813.0},{\"period\":\"2025-02-01\",\"region\":\"EMEA\",\"sales\":1978734.53},{\"period\":\"2025-02-01\",\"region\":\"APAC\",\"sales\":2402811.3500000001},{\"period\":\"2025-02-01\",\"region\":\"AMER\",\"sales\":2459090.9500000002},{\"period\":\"2025-02-01\",\"region\":\"ANZ\",\"sales\":2424491.2200000002},{\"period\":\"2025-03-01\",\"region\":\"AMER\",\"sales\":2842903.3500000001},{\"period\":\"2025-03-01\",\"region\":\"ANZ\",\"sales\":2751303.4199999999},{\"period\":\"2025-03-01\",\"region\":\"APAC\",\"sales\":2636628.8300000001},{\"period\":\"2025-03-01\",\"region\":\"EMEA\",\"sales\":2131917.7200000002},{\"period\":\"2025-04-01\",\"region\":\"AMER\",\"sales\":2550515.0299999998},{\"period\":\"2025-04-01\",\"region\":\"ANZ\",\"sales\":2818059.1400000001},{\"period\":\"2025-04-01\",\"region\":\"APAC\",\"sales\":2808563.8100000001},{\"period\":\"2025-04-01\",\"region\":\"EMEA\",\"sales\":2411886.0099999998},{\"period\":\"2025-05-01\",\"region\":\"EMEA\",\"sales\":2588075.6600000001},{\"period\":\"2025-05-01\",\"region\":\"APAC\",\"sales\":2897709.6400000001},{\"period\":\"2025-05-01\",\"region\":\"ANZ\",\"sales\":2838881.4300000002},{\"period\":\"2025-05-01\",\"region\":\"AMER\",\"sales\":2569486.4300000002},{\"period\":\"2025-06-01\",\"region\":\"AMER\",\"sales\":2568065.4199999999},{\"period\":\"2025-06-01\",\"region\":\"ANZ\",\"sales\":2361097.4500000002},{\"period\":\"2025-06-01\",\"region\":\"APAC\",\"sales\":2088156.1599999999},{\"period\":\"2025-06-01\",\"region\":\"EMEA\",\"sales\":2381482.6099999999},{\"period\":\"2025-07-01\",\"region\":\"AMER\",\"sales\":2599012.3999999999},{\"period\":\"2025-07-01\",\"region\":\"ANZ\",\"sales\":2749322.5499999998},{\"period\":\"2025-07-01\",\"region\":\"APAC\",\"sales\":3102007.0699999998},{\"period\":\"2025-07-01\",\"region\":\"EMEA\",\"sales\":2370515.73},{\"period\":\"2025-08-01\",\"region\":\"APAC\",\"sales\":2373717.5},{\"period\":\"2025-08-01\",\"region\":\"EMEA\",\"sales\":2627527.6499999999},{\"period\":\"2025-08-01\",\"region\":\"AMER\",\"sales\":2654023.5099999998},{\"period\":\"2025-08-01\",\"region\":\"ANZ\",\"sales\":2593661.3199999998},{\"period\":\"2025-09-01\",\"region\":\"AMER\",\"sales\":2755322.3799999999},{\"period\":\"2025-09-01\",\"region\":\"ANZ\",\"sales\":3210920.7200000002},{\"period\":\"2025-09-01\",\"region\":\"APAC\",\"sales\":2990537.1699999999},{\"period\":\"2025-09-01\",\"region\":\"EMEA\",\"sales\":2882441.25},{\"period\":\"2025-10-01\",\"region\":\"AMER\",\"sales\":4010118.5600000001},{\"period\":\"2025-10-01\",\"region\":\"ANZ\",\"sales\":3891276.5099999998},{\"period\":\"2025-10-01\",\"region\":\"APAC\",\"sales\":3558604.1099999999},{\"period\":\"2025-10-01\",\"region\":\"EMEA\",\"sales\":3969809.52},{\"period\":\"2025-11-01\",\"region\":\"APAC\",\"sales\":923968.65},{\"period\":\"2025-11-01\",\"region\":\"AMER\",\"sales\":1189488.46},{\"period\":\"2025-11-01\",\"region\":\"ANZ\",\"sales\":1006080.75},{\"period\":\"2025-11-01\",\"region\":\"EMEA\",\"sales\":923001.4}]\n```", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:35:39.297+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=3785)", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:36:08.234+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 1937, "completion_tokens": 1558, "total_tokens": 3495, "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:36:08.235+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=4713)", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:36:08.238+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:36:08.239+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=2377):\n{'data': [{'type': 'scatter', 'mode': 'lines+markers', 'name': 'AMER', 'x': ['2024-11-01', '2024-12-01', '2025-01-01', '2025-02-01', '2025-03-01', '2025-04-01', '2025-05-01', '2025-06-01', '2025-07-01', '2025-08-01', '2025-09-01', '2025-10-01', '2025-11-01'], 'y': [1258032.44, 2963555.44, 2163861.35, 2459090.95, 2842903.35, 2550515.03, 2569486.43, 2568065.42, 2599012.4, 2654023.51, 2755322.38, 4010118.56, 1189488.46], 'line': {'shape': 'linear'}, 'hovertemplate': '%{x|%b %Y}<br>AMER: %{y:.2f}<extra></extra>'}, {'type': 'scatter', 'mode': 'lines+markers', 'name': 'ANZ', 'x': ['2024-11-01', '2024-12-01', '2025-01-01', '2025-02-01', '2025-03-01', '2025-04-01', '2025-05-01', '2025-06-01', '2025-07-01', '2025-08-01', '2025-09-01', '2025-10-01', '2025-11-01'], 'y': [876639.26, 2668763.66, 2537243, 2424491.22, 2751303.42, 2818059.14, 2838881.43, 2361097.45, 2749322.55, 2593661.32, 3210920.72, 3891276.51, 1006080.75], 'line': {'shape': 'linear'}, 'hovertemplate': '%{x|%b %Y}<br>ANZ: %{y:.2f}<extra></extra>'}, {'type': 'scatter', 'mode': 'lines+markers', 'name': 'APAC', 'x': ['2024-11-01', '2024-12-01', '2025-01-01', '2025-02-01', '2025-03-01', '2025-04-01', '2025-05-01', '2025-06-01', '2025-07-01', '2025-08-01', '2025-09-01', '2025-10-01', '2025-11-01'], 'y': [1125428.81, 2669904.83, 2548097.81, 2402811.35, 2636628.83, 2808563.81, 2897709.64, 2088156.16, 3102007.07, 2373717.5, 2990537.17, 3558604.11, 923968.65], 'line': {'shape': 'linear'}, 'hovertemplate': '%{x|%b %Y}<br>APAC: %{y:.... (truncated)", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:36:08.239+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"AMER\", \"x\": [\"2024-11-01\", \"2024-12-01\", \"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [1258032.44, 2963555.44, 2163861.35, 2459090.95, 2842903.35, 2550515.03, 2569486.43, 2568065.42, 2599012.4, 2654023.51, 2755322.38, 4010118.56, 1189488.46], \"line\": {\"shape\": \"linear\"}, \"hovertemplate\": \"%{x|%b %Y}<br>AMER: %{y:.2f}<extra></extra>\"}, {\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"ANZ\", \"x\": [\"2024-11-01\", \"2024-12-01\", \"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [876639.26, 2668763.66, 2537243, 2424491.22, 2751303.42, 2818059.14, 2838881.43, 2361097.45, 2749322.55, 2593661.32, 3210920.72, 3891276.51, 1006080.75], \"line\": {\"shape\": \"linear\"}, \"hovertemplate\": \"%{x|%b %Y}<br>ANZ: %{y:.2f}<extra></extra>\"}, {\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"APAC\", \"x\": [\"2024-11-01\", \"2024-12-01\", \"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [1125428.81, 2669904.83, 2548097.81, 2402811.35, 2636628.83, 2808563.81, 2897709.64, 2088156.16, 3102007.07, 2373717.5, 2990537.17, 3558604.11, 923968.65], \"line\": {\"shape\": \"linear\"}, \"hovertemplate\": \"%{x|%b %Y}<br>APAC: %{y:.2f}<extra></extra>\"}, {\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"EMEA\", \"x\": [\"2024-11-01\", \"2024-12-01\", \"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [1295948.88, 2426443.18, 2760813, 1978734.53, 2131917.72, 2411886.01, 2588075.66, 2381482.61, 2370515.73, 2627527.65, 2882441.25, 3969809.52, 923001.4], \"line\": {\"shape\": \"linear\"}, \"hovertemplate\": \"%{x|%b %Y}<br>EMEA: %{y:.2f}<extra></extra>\"}], \"layout\": {\"xaxis\": {\"title\": \"Month\", \"type\": \"date\", \"tickformat\": \"%b %Y\", \"tickangle\": -45}, \"yaxis\": {\"title\": \"Sales\", \"tickformat\": \",.0f\"}, \"legend\": {\"x\": 1, \"y\": 1, \"xanchor\": \"left\", \"yanchor\": \"top\"}, \"margin\": {\"l\": 60, \"r\": 150, \"t\": 40, \"b\": 80}, \"hovermode\": \"x unified\", \"title\": {\"text\": \"Sales Trend Over Last 12 Months by Region\"}}}", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:36:08.241+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/714d5c6e717a.json", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:36:08.246+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:36:08.246+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:36:08.247+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:36:08.250+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:36:08.252+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:36:08.256+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:36:08.258+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:36:08.258+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "How have regional sales trended over the last 12 months?", "has_chart": true, "has_narrative": true, "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:36:08.262+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 2377, "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:36:08.262+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 590, "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:36:08.263+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "714d5c6e717a"}
{"timestamp": "2025-11-18T00:36:18.202+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "Compare actual sales and budgeted revenue by quarter.", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:18.207+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:18.217+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:18.221+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=53)", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:18.221+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:20.601+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:20.601+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='Compare actual sales and budgeted revenue by quarter.', metrics=['sales', 'budget_revenue'], dimensions=['quarter'], time_grain='AllPeriods', time_range='past_3_years', filters=[], sort=None, top_k=None, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['Use a bar chart to compare actual sales and budgeted revenue by quarter.', 'Show quarters on the x-axis and values on the y-axis.', 'Use different colors for actual sales and budgeted revenue.']), chart_figure_json=None, narrative=None)]", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:20.604+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:20.604+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:20.605+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:20.606+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:20.608+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:20.608+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:20.609+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:20.610+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['sales', 'budget_revenue'] dims=['quarter']", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:20.610+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:25.013+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4012, "completion_tokens": 183, "total_tokens": 4195, "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:25.013+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=668)", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:25.013+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=668)", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:25.016+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:25.016+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=668):\nWITH base AS (\n  SELECT\n    fact_sales.sale_id,\n    fact_sales.revenue,\n    fact_sales.quantity,\n    fact_sales.unit_price,\n    fact_sales.budget_revenue,\n    dim_date.date\n  FROM public.fact_sales\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE dim_date.date >= make_date(extract(year from current_date)::int - 2, 1, 1)\n),\nagg AS (\n  SELECT\n    date_trunc('quarter', base.date)::date AS period,\n    SUM(COALESCE(base.revenue, base.quantity * base.unit_price)) AS actual_revenue,\n    SUM(base.budget_revenue) AS budget_revenue\n  FROM base\n  GROUP BY 1\n)\nSELECT\n  period,\n  actual_revenue,\n  budget_revenue\nFROM agg\nORDER BY actual_revenue DESC;", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:25.021+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:25.062+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:25.062+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:25.063+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:25.064+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:25.145+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=6, cols=3)", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:25.145+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=6, cols=3)", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:25.148+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (6, 3)", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:25.149+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:25.151+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: Compare actual sales and budgeted revenue by quarter.", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:25.152+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['Use a bar chart to compare actual sales and budgeted revenue by quarter.', 'Show quarters on the x-axis and values on the y-axis.', 'Use different colors for actual sales and budgeted revenue.']}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"period\":\"2024-07-01\",\"actual_revenue\":2303677.9100000001,\"budget_revenue\":2308360.0},{\"period\":\"2024-10-01\",\"actual_revenue\":31409296.0399999991,\"budget_revenue\":31395558.0},{\"period\":\"2025-01-01\",\"actual_revenue\":29637896.5300000012,\"budget_revenue\":29620904.0},{\"period\":\"2025-04-01\",\"actual_revenue\":30881978.7899999991,\"budget_revenue\":30791379.0},{\"period\":\"2025-07-01\",\"actual_revenue\":32909009.25,\"budget_revenue\":27419191.0},{\"period\":\"2025-10-01\",\"actual_revenue\":19472347.9600000009,\"budget_revenue\":19563657.0}]\n```", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:25.152+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=911)", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:36.973+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 846, "completion_tokens": 582, "total_tokens": 1428, "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:36.974+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=1742)", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:36.975+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:36.975+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=885):\n{'data': [{'type': 'bar', 'name': 'Actual Sales', 'x': ['2024-Q3', '2024-Q4', '2025-Q1', '2025-Q2', '2025-Q3', '2025-Q4'], 'y': [2303677.91, 31409296.04, 29637896.53, 30881978.79, 32909009.25, 19472347.96], 'marker': {'color': '#1f77b4'}}, {'type': 'bar', 'name': 'Budgeted Revenue', 'x': ['2024-Q3', '2024-Q4', '2025-Q1', '2025-Q2', '2025-Q3', '2025-Q4'], 'y': [2308360.0, 31395558.0, 29620904.0, 30791379.0, 27419191.0, 19563657.0], 'marker': {'color': '#ff7f0e'}}], 'layout': {'barmode': 'group', 'xaxis': {'title': 'Quarter', 'type': 'category', 'categoryorder': 'array', 'categoryarray': ['2024-Q3', '2024-Q4', '2025-Q1', '2025-Q2', '2025-Q3', '2025-Q4']}, 'yaxis': {'title': 'Revenue', 'tickformat': ',.0f'}, 'legend': {'x': 1, 'y': 1, 'xanchor': 'right', 'yanchor': 'top'}, 'margin': {'t': 40, 'b': 40, 'l': 60, 'r': 40}, 'title': 'Actual Sales vs Budgeted Revenue by Quarter'}}", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:36.976+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"bar\", \"name\": \"Actual Sales\", \"x\": [\"2024-Q3\", \"2024-Q4\", \"2025-Q1\", \"2025-Q2\", \"2025-Q3\", \"2025-Q4\"], \"y\": [2303677.91, 31409296.04, 29637896.53, 30881978.79, 32909009.25, 19472347.96], \"marker\": {\"color\": \"#1f77b4\"}}, {\"type\": \"bar\", \"name\": \"Budgeted Revenue\", \"x\": [\"2024-Q3\", \"2024-Q4\", \"2025-Q1\", \"2025-Q2\", \"2025-Q3\", \"2025-Q4\"], \"y\": [2308360.0, 31395558.0, 29620904.0, 30791379.0, 27419191.0, 19563657.0], \"marker\": {\"color\": \"#ff7f0e\"}}], \"layout\": {\"barmode\": \"group\", \"xaxis\": {\"title\": \"Quarter\", \"type\": \"category\", \"categoryorder\": \"array\", \"categoryarray\": [\"2024-Q3\", \"2024-Q4\", \"2025-Q1\", \"2025-Q2\", \"2025-Q3\", \"2025-Q4\"]}, \"yaxis\": {\"title\": \"Revenue\", \"tickformat\": \",.0f\"}, \"legend\": {\"x\": 1, \"y\": 1, \"xanchor\": \"right\", \"yanchor\": \"top\"}, \"margin\": {\"t\": 40, \"b\": 40, \"l\": 60, \"r\": 40}, \"title\": \"Actual Sales vs Budgeted Revenue by Quarter\"}}", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:36.977+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/7c9f4f70158e.json", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:36.981+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:36.982+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:36.986+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:36.989+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:36.990+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:36.993+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:36.994+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:36.994+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "Compare actual sales and budgeted revenue by quarter.", "has_chart": true, "has_narrative": true, "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:36.997+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 885, "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:36.997+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 539, "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:36.997+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "7c9f4f70158e"}
{"timestamp": "2025-11-18T00:36:49.425+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "How has profit margin trended by product category over the past year?", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:49.429+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:49.439+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:49.444+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=69)", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:49.444+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:52.245+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:52.245+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='How has profit margin trended by product category over the past year?', metrics=['gross_margin'], dimensions=['product_category', 'month'], time_grain='monthly', time_range='past_12_months', filters=[], sort=None, top_k=None, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['Use a line chart to show the trend of gross margin over time.', 'Group lines by product_category.', 'Use monthly time grain over the past 12 months.', 'Label x-axis as month and y-axis as gross margin.', 'Include a legend for product categories.']), chart_figure_json=None, narrative=None)]", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:52.249+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:52.249+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:52.250+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:52.251+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:52.252+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:52.253+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:52.253+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:52.254+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['gross_margin'] dims=['product_category', 'month']", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:52.255+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:56.414+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4016, "completion_tokens": 201, "total_tokens": 4217, "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:56.415+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=781)", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:56.415+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=781)", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:56.415+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:56.415+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=781):\nWITH base AS (\n  SELECT\n    fact_sales.revenue,\n    fact_sales.quantity,\n    fact_sales.unit_price,\n    fact_sales.sales_cost,\n    dim_product.category,\n    dim_date.date\n  FROM public.fact_sales\n  JOIN public.dim_product ON fact_sales.product_sk = dim_product.product_sk\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE dim_date.date >= CURRENT_DATE - interval '12 months'\n),\nagg AS (\n  SELECT\n    date_trunc('month', base.date)::date AS period,\n    base.category,\n    SUM(COALESCE(base.revenue, base.quantity * base.unit_price) - COALESCE(base.sales_cost, 0)) AS gross_margin\n  FROM base\n  GROUP BY 1, 2\n)\nSELECT\n  agg.period,\n  agg.category AS product_category,\n  agg.gross_margin\nFROM agg\nORDER BY agg.gross_margin DESC, agg.period ASC, agg.category ASC;", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:56.416+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:56.440+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:56.440+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:56.441+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:56.442+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:56.508+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=65, cols=3)", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:56.508+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=65, cols=3)", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:56.510+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (65, 3)", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:56.511+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:56.513+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: How has profit margin trended by product category over the past year?", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:56.513+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['Use a line chart to show the trend of gross margin over time.', 'Group lines by product_category.', 'Use monthly time grain over the past 12 months.', 'Label x-axis as month and y-axis as gross margin.', 'Include a legend for product categories.']}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"period\":\"2024-11-01\",\"product_category\":\"Accessories\",\"gross_margin\":58424.46},{\"period\":\"2024-11-01\",\"product_category\":\"Wearables\",\"gross_margin\":136634.76},{\"period\":\"2024-11-01\",\"product_category\":\"Peripherals\",\"gross_margin\":302424.17},{\"period\":\"2024-11-01\",\"product_category\":\"Electronics\",\"gross_margin\":1682652.95},{\"period\":\"2024-11-01\",\"product_category\":\"Computers\",\"gross_margin\":2367687.3700000001},{\"period\":\"2024-12-01\",\"product_category\":\"Accessories\",\"gross_margin\":135504.67},{\"period\":\"2024-12-01\",\"product_category\":\"Wearables\",\"gross_margin\":317591.82},{\"period\":\"2024-12-01\",\"product_category\":\"Electronics\",\"gross_margin\":3831273.4700000002},{\"period\":\"2024-12-01\",\"product_category\":\"Peripherals\",\"gross_margin\":736888.02},{\"period\":\"2024-12-01\",\"product_category\":\"Computers\",\"gross_margin\":5686547.8099999996},{\"period\":\"2025-01-01\",\"product_category\":\"Electronics\",\"gross_margin\":3583147.3300000001},{\"period\":\"2025-01-01\",\"product_category\":\"Wearables\",\"gross_margin\":325792.99},{\"period\":\"2025-01-01\",\"product_category\":\"Computers\",\"gross_margin\":5264708.0300000003},{\"period\":\"2025-01-01\",\"product_category\":\"Peripherals\",\"gross_margin\":692508.51},{\"period\":\"2025-01-01\",\"product_category\":\"Accessories\",\"gross_margin\":123274.42},{\"period\":\"2025-02-01\",\"product_category\":\"Peripherals\",\"gross_margin\":663371.6899999999},{\"period\":\"2025-02-01\",\"product_category\":\"Computers\",\"gross_margin\":4940950.6799999997},{\"period\":\"2025-02-01\",\"product_category\":\"Electronics\",\"gross_margin\":3232817.04},{\"period\":\"2025-02-01\",\"product_category\":\"Accessories\",\"gross_margin\":124185.09},{\"period\":\"2025-02-01\",\"product_category\":\"Wearables\",\"gross_margin\":285475.22},{\"period\":\"2025-03-01\",\"product_category\":\"Wearables\",\"gross_margin\":270039.4},{\"period\":\"2025-03-01\",\"product_category\":\"Peripherals\",\"gross_margin\":797094.75},{\"period\":\"2025-03-01\",\"product_category\":\"Electronics\",\"gross_margin\":3542432.8799999999},{\"period\":\"2025-03-01\",\"product_category\":\"Accessories\",\"gross_margin\":135701.4},{\"period\":\"2025-03-01\",\"product_category\":\"Computers\",\"gross_margin\":5595737.25},{\"period\":\"2025-04-01\",\"product_category\":\"Peripherals\",\"gross_margin\":728810.22},{\"period\":\"2025-04-01\",\"product_category\":\"Accessories\",\"gross_margin\":154517.22},{\"period\":\"2025-04-01\",\"product_category\":\"Computers\",\"gross_margin\":5561596.8700000001},{\"period\":\"2025-04-01\",\"product_category\":\"Electronics\",\"gross_margin\":3842662.27},{\"period\":\"2025-04-01\",\"product_category\":\"Wearables\",\"gross_margin\":280989.57},{\"period\":\"2025-05-01\",\"product_category\":\"Computers\",\"gross_margin\":5907136.6900000004},{\"period\":\"2025-05-01\",\"product_category\":\"Peripherals\",\"gross_margin\":693503.38},{\"period\":\"2025-05-01\",\"product_category\":\"Accessories\",\"gross_margin\":125189.81},{\"period\":\"2025-05-01\",\"product_category\":\"Electronics\",\"gross_margin\":3861470.2200000002},{\"period\":\"2025-05-01\",\"product_category\":\"Wearables\",\"gross_margin\":286174.14},{\"period\":\"2025-06-01\",\"product_category\":\"Wearables\",\"gross_margin\":305530.99},{\"period\":\"2025-06-01\",\"product_category\":\"Peripherals\",\"gross_margin\":665382.39},{\"period\":\"2025-06-01\",\"product_category\":\"Electronics\",\"gross_margin\":3623725.0299999998},{\"period\":\"2025-06-01\",\"product_category\":\"Computers\",\"gross_margin\":4672820.5899999999},{\"period\":\"2025-06-01\",\"product_category\":\"Accessories\",\"gross_margin\":113108.04},{\"period\":\"2025-07-01\",\"product_category\":\"Peripherals\",\"gross_margin\":759178.51},{\"period\":\"2025-07-01\",\"product_category\":\"Wearables\",\"gross_margin\":293139.54},{\"period\":\"2025-07-01\",\"product_category\":\"Electronics\",\"gross_margin\":3821488.9100000001},{\"period\":\"2025-07-01\",\"product_category\":\"Computers\",\"gross_margin\":5773164.0700000003},{\"period\":\"2025-07-01\",\"product_category\":\"Accessories\",\"gross_margin\":151823.94},{\"period\":\"2025-08-01\",\"product_category\":\"Wearables\",\"gross_margin\":267944.78},{\"period\":\"2025-08-01\",\"product_category\":\"Accessories\",\"gross_margin\":137702.79},{\"period\":\"2025-08-01\",\"product_category\":\"Computers\",\"gross_margin\":5159735.0199999996},{\"period\":\"2025-08-01\",\"product_category\":\"Peripherals\",\"gross_margin\":737154.41},{\"period\":\"2025-08-01\",\"product_category\":\"Electronics\",\"gross_margin\":3925731.8799999999},{\"period\":\"2025-09-01\",\"product_category\":\"Wearables\",\"gross_margin\":442288.96},{\"period\":\"2025-09-01\",\"product_category\":\"Accessories\",\"gross_margin\":272014.65},{\"period\":\"2025-09-01\",\"product_category\":\"Electronics\",\"gross_margin\":4120336.7400000002},{\"period\":\"2025-09-01\",\"product_category\":\"Peripherals\",\"gross_margin\":1008753.27},{\"period\":\"2025-09-01\",\"product_category\":\"Computers\",\"gross_margin\":5965762.4500000002},{\"period\":\"2025-10-01\",\"product_category\":\"Electronics\",\"gross_margin\":5312513.7699999996},{\"period\":\"2025-10-01\",\"product_category\":\"Computers\",\"gross_margin\":7333504.2000000002},{\"period\":\"2025-10-01\",\"product_category\":\"Peripherals\",\"gross_margin\":1387073.3200000001},{\"period\":\"2025-10-01\",\"product_category\":\"Wearables\",\"gross_margin\":770904.0699999999},{\"period\":\"2025-10-01\",\"product_category\":\"Accessories\",\"gross_margin\":580286.0},{\"period\":\"2025-11-01\",\"product_category\":\"Computers\",\"gross_margin\":1821476.7},{\"period\":\"2025-11-01\",\"product_category\":\"Wearables\",\"gross_margin\":180127.84},{\"period\":\"2025-11-01\",\"product_category\":\"Accessories\",\"gross_margin\":123077.83},{\"period\":\"2025-11-01\",\"product_category\":\"Peripherals\",\"gross_margin\":370353.78},{\"period\":\"2025-11-01\",\"product_category\":\"Electronics\",\"gross_margin\":1536021.48}]\n```", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:36:56.513+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=5925)", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:37:26.230+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 2249, "completion_tokens": 1702, "total_tokens": 3951, "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:37:26.230+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=5388)", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:37:26.232+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:37:26.232+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=2579):\n{'data': [{'type': 'scatter', 'mode': 'lines+markers', 'name': 'Accessories', 'x': ['2024-11-01', '2024-12-01', '2025-01-01', '2025-02-01', '2025-03-01', '2025-04-01', '2025-05-01', '2025-06-01', '2025-07-01', '2025-08-01', '2025-09-01', '2025-10-01', '2025-11-01'], 'y': [58424.46, 135504.67, 123274.42, 124185.09, 135701.4, 154517.22, 125189.81, 113108.04, 151823.94, 137702.79, 272014.65, 580286, 123077.83], 'line': {'shape': 'linear'}}, {'type': 'scatter', 'mode': 'lines+markers', 'name': 'Wearables', 'x': ['2024-11-01', '2024-12-01', '2025-01-01', '2025-02-01', '2025-03-01', '2025-04-01', '2025-05-01', '2025-06-01', '2025-07-01', '2025-08-01', '2025-09-01', '2025-10-01', '2025-11-01'], 'y': [136634.76, 317591.82, 325792.99, 285475.22, 270039.4, 280989.57, 286174.14, 305530.99, 293139.54, 267944.78, 442288.96, 770904.07, 180127.84], 'line': {'shape': 'linear'}}, {'type': 'scatter', 'mode': 'lines+markers', 'name': 'Peripherals', 'x': ['2024-11-01', '2024-12-01', '2025-01-01', '2025-02-01', '2025-03-01', '2025-04-01', '2025-05-01', '2025-06-01', '2025-07-01', '2025-08-01', '2025-09-01', '2025-10-01', '2025-11-01'], 'y': [302424.17, 736888.02, 692508.51, 663371.69, 797094.75, 728810.22, 693503.38, 665382.39, 759178.51, 737154.41, 1008753.27, 1387073.32, 370353.78], 'line': {'shape': 'linear'}}, {'type': 'scatter', 'mode': 'lines+markers', 'name': 'Electronics', 'x': ['2024-11-01', '2024-12-01', '2025-01-01', '2025-02-01', '2025-03-01', '2025-04-01', '2025-05-01', '2025-06-01',... (truncated)", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:37:26.233+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"Accessories\", \"x\": [\"2024-11-01\", \"2024-12-01\", \"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [58424.46, 135504.67, 123274.42, 124185.09, 135701.4, 154517.22, 125189.81, 113108.04, 151823.94, 137702.79, 272014.65, 580286, 123077.83], \"line\": {\"shape\": \"linear\"}}, {\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"Wearables\", \"x\": [\"2024-11-01\", \"2024-12-01\", \"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [136634.76, 317591.82, 325792.99, 285475.22, 270039.4, 280989.57, 286174.14, 305530.99, 293139.54, 267944.78, 442288.96, 770904.07, 180127.84], \"line\": {\"shape\": \"linear\"}}, {\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"Peripherals\", \"x\": [\"2024-11-01\", \"2024-12-01\", \"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [302424.17, 736888.02, 692508.51, 663371.69, 797094.75, 728810.22, 693503.38, 665382.39, 759178.51, 737154.41, 1008753.27, 1387073.32, 370353.78], \"line\": {\"shape\": \"linear\"}}, {\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"Electronics\", \"x\": [\"2024-11-01\", \"2024-12-01\", \"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [1682652.95, 3831273.47, 3583147.33, 3232817.04, 3542432.88, 3842662.27, 3861470.22, 3623725.03, 3821488.91, 3925731.88, 4120336.74, 5312513.77, 1536021.48], \"line\": {\"shape\": \"linear\"}}, {\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"Computers\", \"x\": [\"2024-11-01\", \"2024-12-01\", \"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [2367687.37, 5686547.81, 5264708.03, 4940950.68, 5595737.25, 5561596.87, 5907136.69, 4672820.59, 5773164.07, 5159735.02, 5965762.45, 7333504.2, 1821476.7], \"line\": {\"shape\": \"linear\"}}], \"layout\": {\"xaxis\": {\"title\": \"month\", \"type\": \"date\", \"tickformat\": \"%Y-%m\"}, \"yaxis\": {\"title\": \"gross margin\"}, \"legend\": {\"x\": 1, \"y\": 1, \"xanchor\": \"left\", \"yanchor\": \"top\"}, \"margin\": {\"l\": 60, \"r\": 150, \"t\": 50, \"b\": 50}, \"hovermode\": \"x unified\", \"title\": {\"text\": \"Gross Margin Trend by Product Category Over Past 12 Months\", \"x\": 0.5, \"xanchor\": \"center\"}}}", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:37:26.234+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/bf844e7a9d30.json", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:37:26.239+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:37:26.240+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:37:26.243+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:37:26.248+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:37:26.249+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:37:26.253+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:37:26.254+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:37:26.255+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "How has profit margin trended by product category over the past year?", "has_chart": true, "has_narrative": true, "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:37:26.257+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 2579, "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:37:26.257+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 733, "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:37:26.257+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "bf844e7a9d30"}
{"timestamp": "2025-11-18T00:37:36.501+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "Which products brought in the most revenue this month?", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:36.506+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:36.517+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:36.521+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=54)", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:36.521+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:38.841+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:38.842+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='Which products brought in the most revenue this month?', metrics=['actual_revenue'], dimensions=['product'], time_grain='AllPeriods', time_range='this_month', filters=[], sort='-actual_revenue', top_k=None, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['Bar chart showing products on the x-axis and actual revenue on the y-axis.', 'Sort bars descending by actual revenue.', \"Focus on this month's data.\"]), chart_figure_json=None, narrative=None)]", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:38.845+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:38.845+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:38.846+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:38.847+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:38.849+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:38.849+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:38.850+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:38.851+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['actual_revenue'] dims=['product']", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:38.851+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:41.747+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4008, "completion_tokens": 152, "total_tokens": 4160, "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:41.747+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=582)", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:41.747+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=582)", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:41.749+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:41.749+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=582):\nWITH base AS (\n  SELECT\n    dim_product.product_name AS product,\n    COALESCE(fact_sales.revenue, fact_sales.quantity * fact_sales.unit_price) AS actual_revenue\n  FROM public.fact_sales\n  JOIN public.dim_product ON fact_sales.product_sk = dim_product.product_sk\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE date_trunc('month', dim_date.date) = date_trunc('month', CURRENT_DATE)\n)\n, agg AS (\n  SELECT\n    product,\n    SUM(actual_revenue) AS actual_revenue\n  FROM base\n  GROUP BY 1\n)\nSELECT\n  product,\n  actual_revenue\nFROM agg\nORDER BY actual_revenue DESC;", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:41.751+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:41.789+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:41.789+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:41.790+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:41.790+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:41.851+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=13, cols=2)", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:41.851+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=13, cols=2)", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:41.852+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (13, 2)", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:41.853+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:41.855+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: Which products brought in the most revenue this month?", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:41.855+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['Bar chart showing products on the x-axis and actual revenue on the y-axis.', 'Sort bars descending by actual revenue.', \"Focus on this month's data.\"]}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"product\":\"Laptop Pro 15\",\"actual_revenue\":1005238.83},{\"product\":\"Phone X1 Pro\",\"actual_revenue\":809641.12},{\"product\":\"Laptop Air 13\",\"actual_revenue\":741785.97},{\"product\":\"Phone X1\",\"actual_revenue\":549372.76},{\"product\":\"4K Monitor 27\\\"\",\"actual_revenue\":246963.48},{\"product\":\"All Products Electronics\",\"actual_revenue\":180059.61},{\"product\":\"Smartwatch G\",\"actual_revenue\":114331.92},{\"product\":\"All Products Peripherals\",\"actual_revenue\":98502.47},{\"product\":\"All Products Accessories\",\"actual_revenue\":80689.77},{\"product\":\"All Products Computers\",\"actual_revenue\":76594.49},{\"product\":\"All Products Wearables\",\"actual_revenue\":67490.99},{\"product\":\"Earbuds S\",\"actual_revenue\":44141.36},{\"product\":\"Gaming Mouse Z\",\"actual_revenue\":27726.49}]\n```", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:41.856+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=1096)", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:52.242+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 851, "completion_tokens": 622, "total_tokens": 1473, "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:52.242+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=2368)", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:52.243+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:52.244+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=1114):\n{'data': [{'type': 'bar', 'x': ['Laptop Pro 15', 'Phone X1 Pro', 'Laptop Air 13', 'Phone X1', '4K Monitor 27\"', 'All Products Electronics', 'Smartwatch G', 'All Products Peripherals', 'All Products Accessories', 'All Products Computers', 'All Products Wearables', 'Earbuds S', 'Gaming Mouse Z'], 'y': [1005238.83, 809641.12, 741785.97, 549372.76, 246963.48, 180059.61, 114331.92, 98502.47, 80689.77, 76594.49, 67490.99, 44141.36, 27726.49], 'marker': {'color': 'blue'}, 'name': 'Actual Revenue'}], 'layout': {'title': {'text': 'Actual Revenue by Product for This Month', 'x': 0.5}, 'xaxis': {'title': 'Product', 'categoryorder': 'array', 'categoryarray': ['Laptop Pro 15', 'Phone X1 Pro', 'Laptop Air 13', 'Phone X1', '4K Monitor 27\"', 'All Products Electronics', 'Smartwatch G', 'All Products Peripherals', 'All Products Accessories', 'All Products Computers', 'All Products Wearables', 'Earbuds S', 'Gaming Mouse Z'], 'tickangle': -45}, 'yaxis': {'title': 'Actual Revenue', 'tickformat': ',.0f'}, 'legend': {'x': 1, 'y': 1, 'xanchor': 'right', 'yanchor': 'top'}, 'margin': {'b': 150, 't': 50, 'l': 80, 'r': 80}}}", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:52.244+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"bar\", \"x\": [\"Laptop Pro 15\", \"Phone X1 Pro\", \"Laptop Air 13\", \"Phone X1\", \"4K Monitor 27\\\"\", \"All Products Electronics\", \"Smartwatch G\", \"All Products Peripherals\", \"All Products Accessories\", \"All Products Computers\", \"All Products Wearables\", \"Earbuds S\", \"Gaming Mouse Z\"], \"y\": [1005238.83, 809641.12, 741785.97, 549372.76, 246963.48, 180059.61, 114331.92, 98502.47, 80689.77, 76594.49, 67490.99, 44141.36, 27726.49], \"marker\": {\"color\": \"blue\"}, \"name\": \"Actual Revenue\"}], \"layout\": {\"title\": {\"text\": \"Actual Revenue by Product for This Month\", \"x\": 0.5}, \"xaxis\": {\"title\": \"Product\", \"categoryorder\": \"array\", \"categoryarray\": [\"Laptop Pro 15\", \"Phone X1 Pro\", \"Laptop Air 13\", \"Phone X1\", \"4K Monitor 27\\\"\", \"All Products Electronics\", \"Smartwatch G\", \"All Products Peripherals\", \"All Products Accessories\", \"All Products Computers\", \"All Products Wearables\", \"Earbuds S\", \"Gaming Mouse Z\"], \"tickangle\": -45}, \"yaxis\": {\"title\": \"Actual Revenue\", \"tickformat\": \",.0f\"}, \"legend\": {\"x\": 1, \"y\": 1, \"xanchor\": \"right\", \"yanchor\": \"top\"}, \"margin\": {\"b\": 150, \"t\": 50, \"l\": 80, \"r\": 80}}}", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:52.246+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/85742a4c055c.json", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:52.250+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:52.250+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:52.253+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:52.255+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:52.257+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:52.261+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:52.262+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:52.262+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "Which products brought in the most revenue this month?", "has_chart": true, "has_narrative": true, "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:52.265+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 1116, "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:52.265+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 490, "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:37:52.265+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "85742a4c055c"}
{"timestamp": "2025-11-18T00:38:05.152+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "Show profit margin by region and product category.", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:05.156+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:05.167+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:05.171+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=50)", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:05.171+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:07.789+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:07.789+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='Show profit margin by region and product category.', metrics=['gross_margin'], dimensions=['region', 'product_category'], time_grain='AllPeriods', time_range='past_3_years', filters=[], sort=None, top_k=None, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['Use a bar chart to show gross margin grouped by region and product category.', 'Group bars by region on the x-axis and use different colors for product categories.', 'Include a legend for product categories.', 'Label y-axis as Gross Margin.']), chart_figure_json=None, narrative=None)]", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:07.792+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:07.792+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:07.794+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:07.794+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:07.796+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:07.797+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:07.798+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:07.798+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['gross_margin'] dims=['region', 'product_category']", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:07.799+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:11.051+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4012, "completion_tokens": 214, "total_tokens": 4226, "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:11.051+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=827)", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:11.051+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=827)", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:11.053+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:11.053+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=827):\nWITH base AS (\n  SELECT\n    fact_sales.region_sk,\n    dim_region.region_name,\n    dim_product.category,\n    (COALESCE(fact_sales.revenue, fact_sales.quantity * fact_sales.unit_price) - COALESCE(fact_sales.sales_cost, 0)) AS gross_margin\n  FROM public.fact_sales\n  JOIN public.dim_region ON fact_sales.region_sk = dim_region.region_sk\n  JOIN public.dim_product ON fact_sales.product_sk = dim_product.product_sk\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE dim_date.date >= make_date(extract(year from current_date)::int - 2, 1, 1)\n)\n, agg AS (\n  SELECT\n    region_name,\n    category,\n    SUM(gross_margin) AS gross_margin\n  FROM base\n  GROUP BY 1, 2\n)\nSELECT\n  region_name AS region,\n  category AS product_category,\n  gross_margin\nFROM agg\nORDER BY gross_margin DESC, region ASC, product_category ASC;", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:11.056+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:11.090+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:11.090+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:11.092+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:11.092+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:11.165+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=20, cols=3)", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:11.165+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=20, cols=3)", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:11.167+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (20, 3)", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:11.168+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:11.169+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: Show profit margin by region and product category.", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:11.169+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['Use a bar chart to show gross margin grouped by region and product category.', 'Group bars by region on the x-axis and use different colors for product categories.', 'Include a legend for product categories.', 'Label y-axis as Gross Margin.']}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"region\":\"ANZ\",\"product_category\":\"Computers\",\"gross_margin\":19360470.4800000004},{\"region\":\"AMER\",\"product_category\":\"Computers\",\"gross_margin\":19278932.9299999997},{\"region\":\"APAC\",\"product_category\":\"Computers\",\"gross_margin\":18858346.0899999999},{\"region\":\"EMEA\",\"product_category\":\"Computers\",\"gross_margin\":17916549.1600000001},{\"region\":\"APAC\",\"product_category\":\"Electronics\",\"gross_margin\":13576367.1600000001},{\"region\":\"AMER\",\"product_category\":\"Electronics\",\"gross_margin\":13286393.1400000006},{\"region\":\"ANZ\",\"product_category\":\"Electronics\",\"gross_margin\":13223721.9199999999},{\"region\":\"EMEA\",\"product_category\":\"Electronics\",\"gross_margin\":12696759.8699999992},{\"region\":\"APAC\",\"product_category\":\"Peripherals\",\"gross_margin\":2824583.9500000002},{\"region\":\"ANZ\",\"product_category\":\"Peripherals\",\"gross_margin\":2763597.3399999999},{\"region\":\"EMEA\",\"product_category\":\"Peripherals\",\"gross_margin\":2707921.6800000002},{\"region\":\"AMER\",\"product_category\":\"Peripherals\",\"gross_margin\":2638410.4300000002},{\"region\":\"EMEA\",\"product_category\":\"Wearables\",\"gross_margin\":1213271.02},{\"region\":\"ANZ\",\"product_category\":\"Wearables\",\"gross_margin\":1166850.5800000001},{\"region\":\"AMER\",\"product_category\":\"Wearables\",\"gross_margin\":1159744.03},{\"region\":\"APAC\",\"product_category\":\"Wearables\",\"gross_margin\":1157267.6499999999},{\"region\":\"AMER\",\"product_category\":\"Accessories\",\"gross_margin\":648384.54},{\"region\":\"ANZ\",\"product_category\":\"Accessories\",\"gross_margin\":619252.76},{\"region\":\"APAC\",\"product_category\":\"Accessories\",\"gross_margin\":607782.25},{\"region\":\"EMEA\",\"product_category\":\"Accessories\",\"gross_margin\":593667.49}]\n```", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:11.169+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=2070)", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:23.062+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 1098, "completion_tokens": 728, "total_tokens": 1826, "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:23.062+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=2286)", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:23.064+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:23.064+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=1183):\n{'data': [{'type': 'bar', 'x': ['ANZ', 'AMER', 'APAC', 'EMEA'], 'y': [19360470.48, 19278932.93, 18858346.09, 17916549.16], 'name': 'Computers', 'marker': {'color': '#1f77b4'}, 'offsetgroup': 0}, {'type': 'bar', 'x': ['ANZ', 'AMER', 'APAC', 'EMEA'], 'y': [13223721.92, 13286393.14, 13576367.16, 12696759.87], 'name': 'Electronics', 'marker': {'color': '#ff7f0e'}, 'offsetgroup': 1}, {'type': 'bar', 'x': ['ANZ', 'AMER', 'APAC', 'EMEA'], 'y': [2763597.34, 2638410.43, 2824583.95, 2707921.68], 'name': 'Peripherals', 'marker': {'color': '#2ca02c'}, 'offsetgroup': 2}, {'type': 'bar', 'x': ['ANZ', 'AMER', 'APAC', 'EMEA'], 'y': [1166850.58, 1159744.03, 1157267.65, 1213271.02], 'name': 'Wearables', 'marker': {'color': '#d62728'}, 'offsetgroup': 3}, {'type': 'bar', 'x': ['ANZ', 'AMER', 'APAC', 'EMEA'], 'y': [619252.76, 648384.54, 607782.25, 593667.49], 'name': 'Accessories', 'marker': {'color': '#9467bd'}, 'offsetgroup': 4}], 'layout': {'barmode': 'group', 'xaxis': {'title': 'Region', 'type': 'category'}, 'yaxis': {'title': 'Gross Margin'}, 'legend': {'x': 1, 'y': 1, 'xanchor': 'left', 'yanchor': 'top'}, 'margin': {'t': 40, 'b': 40, 'l': 60, 'r': 150}, 'hovermode': 'x unified'}}", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:23.064+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"bar\", \"x\": [\"ANZ\", \"AMER\", \"APAC\", \"EMEA\"], \"y\": [19360470.48, 19278932.93, 18858346.09, 17916549.16], \"name\": \"Computers\", \"marker\": {\"color\": \"#1f77b4\"}, \"offsetgroup\": 0}, {\"type\": \"bar\", \"x\": [\"ANZ\", \"AMER\", \"APAC\", \"EMEA\"], \"y\": [13223721.92, 13286393.14, 13576367.16, 12696759.87], \"name\": \"Electronics\", \"marker\": {\"color\": \"#ff7f0e\"}, \"offsetgroup\": 1}, {\"type\": \"bar\", \"x\": [\"ANZ\", \"AMER\", \"APAC\", \"EMEA\"], \"y\": [2763597.34, 2638410.43, 2824583.95, 2707921.68], \"name\": \"Peripherals\", \"marker\": {\"color\": \"#2ca02c\"}, \"offsetgroup\": 2}, {\"type\": \"bar\", \"x\": [\"ANZ\", \"AMER\", \"APAC\", \"EMEA\"], \"y\": [1166850.58, 1159744.03, 1157267.65, 1213271.02], \"name\": \"Wearables\", \"marker\": {\"color\": \"#d62728\"}, \"offsetgroup\": 3}, {\"type\": \"bar\", \"x\": [\"ANZ\", \"AMER\", \"APAC\", \"EMEA\"], \"y\": [619252.76, 648384.54, 607782.25, 593667.49], \"name\": \"Accessories\", \"marker\": {\"color\": \"#9467bd\"}, \"offsetgroup\": 4}], \"layout\": {\"barmode\": \"group\", \"xaxis\": {\"title\": \"Region\", \"type\": \"category\"}, \"yaxis\": {\"title\": \"Gross Margin\"}, \"legend\": {\"x\": 1, \"y\": 1, \"xanchor\": \"left\", \"yanchor\": \"top\"}, \"margin\": {\"t\": 40, \"b\": 40, \"l\": 60, \"r\": 150}, \"hovermode\": \"x unified\"}}", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:23.067+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/8acc944fd1f3.json", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:23.071+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:23.071+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:23.073+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:23.077+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:23.079+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:23.082+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:23.084+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:23.084+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "Show profit margin by region and product category.", "has_chart": true, "has_narrative": true, "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:23.086+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 1183, "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:23.087+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 567, "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:23.087+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "8acc944fd1f3"}
{"timestamp": "2025-11-18T00:38:33.367+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "Compare total sales by region and salesperson.", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:33.371+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:33.382+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:33.387+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=46)", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:33.387+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:36.714+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:36.714+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='Compare total sales by region and salesperson.', metrics=['sales'], dimensions=['region', 'salesperson'], time_grain='AllPeriods', time_range='past_3_years', filters=[], sort=None, top_k=None, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['Use a bar chart to compare total sales.', 'Group bars by region and salesperson.', 'Show sales as the metric on the y-axis.', 'Include a legend for salesperson.', \"Title the chart 'Total Sales by Region and Salesperson'.\"]), chart_figure_json=None, narrative=None)]", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:36.717+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:36.718+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:36.719+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:36.720+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:36.721+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:36.722+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:36.723+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:36.723+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['sales'] dims=['region', 'salesperson']", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:36.724+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:40.579+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4008, "completion_tokens": 205, "total_tokens": 4213, "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:40.579+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=803)", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:40.580+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=803)", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:40.581+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:40.581+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=803):\nWITH base AS (\n  SELECT\n    fact_sales.sale_id,\n    dim_region.region_name,\n    dim_salesperson.salesperson_name,\n    COALESCE(fact_sales.revenue, fact_sales.quantity * fact_sales.unit_price) AS actual_revenue\n  FROM public.fact_sales\n  JOIN public.dim_region ON fact_sales.region_sk = dim_region.region_sk\n  JOIN public.dim_salesperson ON fact_sales.salesperson_sk = dim_salesperson.salesperson_sk\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE dim_date.date >= make_date(extract(year from current_date)::int - 2, 1, 1)\n)\n, agg AS (\n  SELECT\n    region_name,\n    salesperson_name,\n    SUM(actual_revenue) AS sales\n  FROM base\n  GROUP BY 1, 2\n)\nSELECT\n  region_name AS region,\n  salesperson_name AS salesperson,\n  sales\nFROM agg\nORDER BY sales DESC, region ASC, salesperson ASC;", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:40.582+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:40.609+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:40.609+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:40.611+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:40.611+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:40.676+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=8, cols=3)", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:40.676+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=8, cols=3)", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:40.678+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (8, 3)", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:40.679+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:40.680+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: Compare total sales by region and salesperson.", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:40.681+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['Use a bar chart to compare total sales.', 'Group bars by region and salesperson.', 'Show sales as the metric on the y-axis.', 'Include a legend for salesperson.', \"Title the chart 'Total Sales by Region and Salesperson'.\"]}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"region\":\"APAC\",\"salesperson\":\"Ken Tanaka\",\"sales\":18777689.379999999},{\"region\":\"ANZ\",\"salesperson\":\"Alex Morgan\",\"sales\":18679990.1900000013},{\"region\":\"AMER\",\"salesperson\":\"Taylor Reese\",\"sales\":18570770.3500000015},{\"region\":\"ANZ\",\"salesperson\":\"Jamie Lee\",\"sales\":18533342.9299999997},{\"region\":\"AMER\",\"salesperson\":\"Jordan Diaz\",\"sales\":18519717.5500000007},{\"region\":\"APAC\",\"salesperson\":\"Priya Shah\",\"sales\":18327342.379999999},{\"region\":\"EMEA\",\"salesperson\":\"Lara Schmidt\",\"sales\":17608120.4899999984},{\"region\":\"EMEA\",\"salesperson\":\"Hassan Ali\",\"sales\":17597233.2100000009}]\n```", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:40.681+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=1000)", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:52.012+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 842, "completion_tokens": 723, "total_tokens": 1565, "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:52.012+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=2378)", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:52.014+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:52.015+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=1312):\n{'data': [{'type': 'bar', 'x': ['APAC', 'APAC'], 'y': [18777689.38, 18327342.38], 'name': 'Ken Tanaka', 'marker': {'color': '#1f77b4'}, 'legendgroup': 'Ken Tanaka'}, {'type': 'bar', 'x': ['ANZ', 'ANZ'], 'y': [18679990.19, 18533342.93], 'name': 'Alex Morgan', 'marker': {'color': '#ff7f0e'}, 'legendgroup': 'Alex Morgan'}, {'type': 'bar', 'x': ['AMER', 'AMER'], 'y': [18570770.35, 18519717.55], 'name': 'Taylor Reese', 'marker': {'color': '#2ca02c'}, 'legendgroup': 'Taylor Reese'}, {'type': 'bar', 'x': ['ANZ'], 'y': [18533342.93], 'name': 'Jamie Lee', 'marker': {'color': '#d62728'}, 'legendgroup': 'Jamie Lee'}, {'type': 'bar', 'x': ['AMER'], 'y': [18519717.55], 'name': 'Jordan Diaz', 'marker': {'color': '#9467bd'}, 'legendgroup': 'Jordan Diaz'}, {'type': 'bar', 'x': ['EMEA', 'EMEA'], 'y': [17608120.49, 17597233.21], 'name': 'Lara Schmidt', 'marker': {'color': '#8c564b'}, 'legendgroup': 'Lara Schmidt'}, {'type': 'bar', 'x': ['EMEA'], 'y': [17597233.21], 'name': 'Hassan Ali', 'marker': {'color': '#e377c2'}, 'legendgroup': 'Hassan Ali'}], 'layout': {'title': {'text': 'Total Sales by Region and Salesperson'}, 'barmode': 'group', 'xaxis': {'title': 'Region'}, 'yaxis': {'title': 'Sales'}, 'legend': {'x': 1, 'y': 1, 'xanchor': 'right', 'yanchor': 'top'}, 'margin': {'t': 50, 'b': 50, 'l': 50, 'r': 150}}}", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:52.015+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"bar\", \"x\": [\"APAC\", \"APAC\"], \"y\": [18777689.38, 18327342.38], \"name\": \"Ken Tanaka\", \"marker\": {\"color\": \"#1f77b4\"}, \"legendgroup\": \"Ken Tanaka\"}, {\"type\": \"bar\", \"x\": [\"ANZ\", \"ANZ\"], \"y\": [18679990.19, 18533342.93], \"name\": \"Alex Morgan\", \"marker\": {\"color\": \"#ff7f0e\"}, \"legendgroup\": \"Alex Morgan\"}, {\"type\": \"bar\", \"x\": [\"AMER\", \"AMER\"], \"y\": [18570770.35, 18519717.55], \"name\": \"Taylor Reese\", \"marker\": {\"color\": \"#2ca02c\"}, \"legendgroup\": \"Taylor Reese\"}, {\"type\": \"bar\", \"x\": [\"ANZ\"], \"y\": [18533342.93], \"name\": \"Jamie Lee\", \"marker\": {\"color\": \"#d62728\"}, \"legendgroup\": \"Jamie Lee\"}, {\"type\": \"bar\", \"x\": [\"AMER\"], \"y\": [18519717.55], \"name\": \"Jordan Diaz\", \"marker\": {\"color\": \"#9467bd\"}, \"legendgroup\": \"Jordan Diaz\"}, {\"type\": \"bar\", \"x\": [\"EMEA\", \"EMEA\"], \"y\": [17608120.49, 17597233.21], \"name\": \"Lara Schmidt\", \"marker\": {\"color\": \"#8c564b\"}, \"legendgroup\": \"Lara Schmidt\"}, {\"type\": \"bar\", \"x\": [\"EMEA\"], \"y\": [17597233.21], \"name\": \"Hassan Ali\", \"marker\": {\"color\": \"#e377c2\"}, \"legendgroup\": \"Hassan Ali\"}], \"layout\": {\"title\": {\"text\": \"Total Sales by Region and Salesperson\"}, \"barmode\": \"group\", \"xaxis\": {\"title\": \"Region\"}, \"yaxis\": {\"title\": \"Sales\"}, \"legend\": {\"x\": 1, \"y\": 1, \"xanchor\": \"right\", \"yanchor\": \"top\"}, \"margin\": {\"t\": 50, \"b\": 50, \"l\": 50, \"r\": 150}}}", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:52.018+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/8d517c8281bd.json", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:52.022+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:52.022+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:52.024+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:52.026+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:52.028+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:52.031+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:52.033+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:52.033+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "Compare total sales by region and salesperson.", "has_chart": true, "has_narrative": true, "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:52.035+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 1312, "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:52.036+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 526, "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T00:38:52.036+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "8d517c8281bd"}
{"timestamp": "2025-11-18T01:27:58.067+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "How do total units sold and overall revenue compare year over year?", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:27:58.072+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:27:58.083+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:27:58.089+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=67)", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:27:58.089+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:01.208+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:01.208+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='How do total units sold and overall revenue compare year over year?', metrics=['units_sold', 'actual_revenue'], dimensions=['year'], time_grain='yearly', time_range='past_3_years', filters=[], sort=None, top_k=None, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['Use a line chart to show units sold and actual revenue over years.', 'Plot two lines: one for units sold and one for actual revenue.', 'Use year on the x-axis and metric values on the y-axis.', 'Include a legend to distinguish units sold and actual revenue.']), chart_figure_json=None, narrative=None)]", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:01.212+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:01.212+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:01.214+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:01.214+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:01.216+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:01.216+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:01.217+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:01.218+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['units_sold', 'actual_revenue'] dims=['year']", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:01.219+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:05.484+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4019, "completion_tokens": 214, "total_tokens": 4233, "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:05.485+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=769)", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:05.485+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=769)", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:05.487+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:05.487+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=769):\nWITH base AS (\n  SELECT\n    fact_sales.sale_id,\n    fact_sales.quantity,\n    fact_sales.unit_price,\n    fact_sales.revenue,\n    fact_sales.sales_cost,\n    fact_sales.budget_revenue,\n    dim_date.date,\n    dim_date.year\n  FROM public.fact_sales\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE dim_date.date >= make_date(extract(year from current_date)::int - 2, 1, 1)\n),\nagg AS (\n  SELECT\n    date_trunc('year', base.date)::date AS period,\n    base.year,\n    SUM(base.quantity) AS units_sold,\n    SUM(COALESCE(base.revenue, base.quantity * base.unit_price)) AS actual_revenue\n  FROM base\n  GROUP BY 1, 2\n)\nSELECT\n  agg.period,\n  agg.year,\n  agg.units_sold,\n  agg.actual_revenue\nFROM agg\nORDER BY agg.units_sold DESC, agg.period ASC, agg.year ASC;", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:05.489+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:05.532+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:05.532+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:05.534+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:05.535+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:05.610+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=2, cols=4)", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:05.611+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=2, cols=4)", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:05.613+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (2, 4)", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:05.614+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:05.615+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: How do total units sold and overall revenue compare year over year?", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:05.615+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['Use a line chart to show units sold and actual revenue over years.', 'Plot two lines: one for units sold and one for actual revenue.', 'Use year on the x-axis and metric values on the y-axis.', 'Include a legend to distinguish units sold and actual revenue.']}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"period\":\"2024-01-01\",\"year\":2024,\"units_sold\":43747,\"actual_revenue\":33712973.950000003},{\"period\":\"2025-01-01\",\"year\":2025,\"units_sold\":159990,\"actual_revenue\":112901232.5300000012}]\n```", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:05.615+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=637)", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:14.308+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 739, "completion_tokens": 455, "total_tokens": 1194, "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:14.308+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=1502)", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:14.310+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:14.310+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=698):\n{'data': [{'type': 'scatter', 'mode': 'lines+markers', 'name': 'Units Sold', 'x': [2024, 2025], 'y': [43747, 159990], 'line': {'color': '#1f77b4'}, 'yaxis': 'y1'}, {'type': 'scatter', 'mode': 'lines+markers', 'name': 'Actual Revenue', 'x': [2024, 2025], 'y': [33712973.95, 112901232.53], 'line': {'color': '#ff7f0e'}, 'yaxis': 'y1'}], 'layout': {'title': {'text': 'Units Sold and Actual Revenue Over Years'}, 'xaxis': {'title': 'Year', 'type': 'category', 'tickvals': [2024, 2025], 'ticktext': ['2024', '2025']}, 'yaxis': {'title': 'Value', 'tickformat': ',', 'rangemode': 'tozero'}, 'legend': {'x': 1, 'y': 1, 'xanchor': 'right', 'yanchor': 'top'}, 'margin': {'l': 60, 'r': 40, 't': 60, 'b': 60}}}", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:14.311+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"Units Sold\", \"x\": [2024, 2025], \"y\": [43747, 159990], \"line\": {\"color\": \"#1f77b4\"}, \"yaxis\": \"y1\"}, {\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"Actual Revenue\", \"x\": [2024, 2025], \"y\": [33712973.95, 112901232.53], \"line\": {\"color\": \"#ff7f0e\"}, \"yaxis\": \"y1\"}], \"layout\": {\"title\": {\"text\": \"Units Sold and Actual Revenue Over Years\"}, \"xaxis\": {\"title\": \"Year\", \"type\": \"category\", \"tickvals\": [2024, 2025], \"ticktext\": [\"2024\", \"2025\"]}, \"yaxis\": {\"title\": \"Value\", \"tickformat\": \",\", \"rangemode\": \"tozero\"}, \"legend\": {\"x\": 1, \"y\": 1, \"xanchor\": \"right\", \"yanchor\": \"top\"}, \"margin\": {\"l\": 60, \"r\": 40, \"t\": 60, \"b\": 60}}}", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:14.313+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/92fe792ef175.json", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:14.317+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:14.317+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:14.318+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:14.321+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:14.322+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:14.325+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:14.326+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:14.326+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "How do total units sold and overall revenue compare year over year?", "has_chart": true, "has_narrative": true, "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:14.329+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 698, "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:14.329+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 452, "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:14.329+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "92fe792ef175"}
{"timestamp": "2025-11-18T01:28:42.846+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "How do actual sales by product category compare to the budget?", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:42.849+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:42.860+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:42.864+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=62)", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:42.864+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:46.268+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:46.269+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='How do actual sales by product category compare to the budget?', metrics=['actual_revenue', 'budget_revenue'], dimensions=['product_category'], time_grain='AllPeriods', time_range='past_3_years', filters=[], sort=None, top_k=None, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['Use a bar chart to compare actual sales and budget by product category.', 'Group bars by product category with two bars per category: actual sales and budget.', 'Include a legend to distinguish actual sales and budget.']), chart_figure_json=None, narrative=None)]", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:46.272+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:46.272+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:46.273+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:46.273+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:46.274+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:46.275+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:46.276+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:46.276+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['actual_revenue', 'budget_revenue'] dims=['product_category']", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:46.277+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:49.887+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4019, "completion_tokens": 184, "total_tokens": 4203, "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:49.887+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=695)", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:49.887+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=695)", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:49.889+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:49.889+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=695):\nWITH base AS (\n  SELECT\n    dim_product.category AS category,\n    COALESCE(fact_sales.revenue, fact_sales.quantity * fact_sales.unit_price) AS actual_revenue,\n    fact_sales.budget_revenue AS budget_revenue\n  FROM public.fact_sales\n  JOIN public.dim_product ON fact_sales.product_sk = dim_product.product_sk\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE dim_date.date >= make_date(extract(year from current_date)::int - 2, 1, 1)\n)\n, agg AS (\n  SELECT\n    category,\n    SUM(actual_revenue) AS actual_revenue,\n    SUM(budget_revenue) AS budget_revenue\n  FROM base\n  GROUP BY 1\n)\nSELECT\n  category,\n  actual_revenue,\n  budget_revenue\nFROM agg\nORDER BY actual_revenue DESC;", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:49.891+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:49.929+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:49.929+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:49.930+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:49.931+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:50.004+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=5, cols=3)", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:50.005+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=5, cols=3)", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:50.006+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (5, 3)", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:50.008+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:50.009+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: How do actual sales by product category compare to the budget?", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:50.009+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['Use a bar chart to compare actual sales and budget by product category.', 'Group bars by product category with two bars per category: actual sales and budget.', 'Include a legend to distinguish actual sales and budget.']}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"category\":\"Computers\",\"actual_revenue\":75491450.5900000036,\"budget_revenue\":72818912.0},{\"category\":\"Electronics\",\"actual_revenue\":52860091.049999997,\"budget_revenue\":50993252.0},{\"category\":\"Peripherals\",\"actual_revenue\":11013378.2200000007,\"budget_revenue\":10519295.0},{\"category\":\"Wearables\",\"actual_revenue\":4738342.5099999998,\"budget_revenue\":4454352.0},{\"category\":\"Accessories\",\"actual_revenue\":2510944.1099999999,\"budget_revenue\":2313238.0}]\n```", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:50.009+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=864)", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:57.952+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 796, "completion_tokens": 439, "total_tokens": 1235, "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:57.952+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=1506)", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:57.954+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:57.955+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=713):\n{'data': [{'type': 'bar', 'name': 'Actual Sales', 'x': ['Computers', 'Electronics', 'Peripherals', 'Wearables', 'Accessories'], 'y': [75491450.59, 52860091.05, 11013378.22, 4738342.51, 2510944.11], 'marker': {'color': '#1f77b4'}}, {'type': 'bar', 'name': 'Budget', 'x': ['Computers', 'Electronics', 'Peripherals', 'Wearables', 'Accessories'], 'y': [72818912.0, 50993252.0, 10519295.0, 4454352.0, 2313238.0], 'marker': {'color': '#ff7f0e'}}], 'layout': {'barmode': 'group', 'legend': {'x': 1, 'y': 1, 'xanchor': 'right', 'yanchor': 'top'}, 'xaxis': {'title': 'Product Category'}, 'yaxis': {'title': 'Revenue'}, 'margin': {'l': 60, 'r': 20, 't': 40, 'b': 60}, 'title': 'Actual Sales vs Budget by Product Category'}}", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:57.955+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"bar\", \"name\": \"Actual Sales\", \"x\": [\"Computers\", \"Electronics\", \"Peripherals\", \"Wearables\", \"Accessories\"], \"y\": [75491450.59, 52860091.05, 11013378.22, 4738342.51, 2510944.11], \"marker\": {\"color\": \"#1f77b4\"}}, {\"type\": \"bar\", \"name\": \"Budget\", \"x\": [\"Computers\", \"Electronics\", \"Peripherals\", \"Wearables\", \"Accessories\"], \"y\": [72818912.0, 50993252.0, 10519295.0, 4454352.0, 2313238.0], \"marker\": {\"color\": \"#ff7f0e\"}}], \"layout\": {\"barmode\": \"group\", \"legend\": {\"x\": 1, \"y\": 1, \"xanchor\": \"right\", \"yanchor\": \"top\"}, \"xaxis\": {\"title\": \"Product Category\"}, \"yaxis\": {\"title\": \"Revenue\"}, \"margin\": {\"l\": 60, \"r\": 20, \"t\": 40, \"b\": 60}, \"title\": \"Actual Sales vs Budget by Product Category\"}}", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:57.956+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/9a720866e909.json", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:57.960+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:57.960+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:57.962+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:57.964+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:57.966+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:57.969+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:57.972+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:57.972+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "How do actual sales by product category compare to the budget?", "has_chart": true, "has_narrative": true, "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:57.974+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 713, "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:57.975+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 579, "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:28:57.975+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "9a720866e909"}
{"timestamp": "2025-11-18T01:29:41.627+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "Show the trend of units sold for each product category over the past year.", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:41.630+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:41.641+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:41.646+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=74)", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:41.646+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:44.986+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:44.987+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='Show the trend of units sold for each product category over the past year.', metrics=['units_sold'], dimensions=['product_category', 'month'], time_grain='monthly', time_range='past_12_months', filters=[], sort=None, top_k=None, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['Use a line chart to show the trend of units sold over time.', 'Group data by product_category and month.', 'X-axis represents time (month), Y-axis represents units sold.', 'Use different lines/colors for each product_category.', 'Include a legend for product categories.']), chart_figure_json=None, narrative=None)]", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:44.990+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:44.990+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:44.991+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:44.992+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:44.993+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:44.994+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:44.995+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:44.995+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['units_sold'] dims=['product_category', 'month']", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:44.996+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:47.850+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4019, "completion_tokens": 165, "total_tokens": 4184, "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:47.850+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=623)", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:47.850+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=623)", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:47.851+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:47.851+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=623):\nWITH base AS (\n  SELECT\n    fact_sales.quantity AS quantity,\n    dim_product.category AS category,\n    dim_date.date AS date\n  FROM public.fact_sales\n  JOIN public.dim_product ON fact_sales.product_sk = dim_product.product_sk\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE dim_date.date >= CURRENT_DATE - interval '12 months'\n),\nagg AS (\n  SELECT\n    date_trunc('month', base.date)::date AS period,\n    base.category,\n    SUM(base.quantity) AS units_sold\n  FROM base\n  GROUP BY 1, 2\n)\nSELECT\n  agg.period,\n  agg.category AS product_category,\n  agg.units_sold\nFROM agg\nORDER BY 1 ASC, 2 ASC, 3 DESC;", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:47.853+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:47.882+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:47.883+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:47.884+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:47.884+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:47.954+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=65, cols=3)", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:47.955+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=65, cols=3)", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:47.957+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (65, 3)", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:47.958+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:47.960+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: Show the trend of units sold for each product category over the past year.", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:47.960+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['Use a line chart to show the trend of units sold over time.', 'Group data by product_category and month.', 'X-axis represents time (month), Y-axis represents units sold.', 'Use different lines/colors for each product_category.', 'Include a legend for product categories.']}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"period\":\"2024-11-01\",\"product_category\":\"Accessories\",\"units_sold\":600},{\"period\":\"2024-11-01\",\"product_category\":\"Computers\",\"units_sold\":1560},{\"period\":\"2024-11-01\",\"product_category\":\"Electronics\",\"units_sold\":1890},{\"period\":\"2024-11-01\",\"product_category\":\"Peripherals\",\"units_sold\":1227},{\"period\":\"2024-11-01\",\"product_category\":\"Wearables\",\"units_sold\":553},{\"period\":\"2024-12-01\",\"product_category\":\"Wearables\",\"units_sold\":1283},{\"period\":\"2024-12-01\",\"product_category\":\"Electronics\",\"units_sold\":4290},{\"period\":\"2024-12-01\",\"product_category\":\"Peripherals\",\"units_sold\":3017},{\"period\":\"2024-12-01\",\"product_category\":\"Accessories\",\"units_sold\":1395},{\"period\":\"2024-12-01\",\"product_category\":\"Computers\",\"units_sold\":3787},{\"period\":\"2025-01-01\",\"product_category\":\"Accessories\",\"units_sold\":1267},{\"period\":\"2025-01-01\",\"product_category\":\"Computers\",\"units_sold\":3505},{\"period\":\"2025-01-01\",\"product_category\":\"Electronics\",\"units_sold\":3984},{\"period\":\"2025-01-01\",\"product_category\":\"Peripherals\",\"units_sold\":3015},{\"period\":\"2025-01-01\",\"product_category\":\"Wearables\",\"units_sold\":1320},{\"period\":\"2025-02-01\",\"product_category\":\"Wearables\",\"units_sold\":1157},{\"period\":\"2025-02-01\",\"product_category\":\"Peripherals\",\"units_sold\":2659},{\"period\":\"2025-02-01\",\"product_category\":\"Accessories\",\"units_sold\":1277},{\"period\":\"2025-02-01\",\"product_category\":\"Computers\",\"units_sold\":3424},{\"period\":\"2025-02-01\",\"product_category\":\"Electronics\",\"units_sold\":3557},{\"period\":\"2025-03-01\",\"product_category\":\"Accessories\",\"units_sold\":1396},{\"period\":\"2025-03-01\",\"product_category\":\"Computers\",\"units_sold\":3708},{\"period\":\"2025-03-01\",\"product_category\":\"Electronics\",\"units_sold\":3973},{\"period\":\"2025-03-01\",\"product_category\":\"Peripherals\",\"units_sold\":3198},{\"period\":\"2025-03-01\",\"product_category\":\"Wearables\",\"units_sold\":1095},{\"period\":\"2025-04-01\",\"product_category\":\"Accessories\",\"units_sold\":1591},{\"period\":\"2025-04-01\",\"product_category\":\"Computers\",\"units_sold\":3747},{\"period\":\"2025-04-01\",\"product_category\":\"Electronics\",\"units_sold\":4287},{\"period\":\"2025-04-01\",\"product_category\":\"Peripherals\",\"units_sold\":2899},{\"period\":\"2025-04-01\",\"product_category\":\"Wearables\",\"units_sold\":1139},{\"period\":\"2025-05-01\",\"product_category\":\"Wearables\",\"units_sold\":1158},{\"period\":\"2025-05-01\",\"product_category\":\"Peripherals\",\"units_sold\":2906},{\"period\":\"2025-05-01\",\"product_category\":\"Electronics\",\"units_sold\":4301},{\"period\":\"2025-05-01\",\"product_category\":\"Computers\",\"units_sold\":3918},{\"period\":\"2025-05-01\",\"product_category\":\"Accessories\",\"units_sold\":1294},{\"period\":\"2025-06-01\",\"product_category\":\"Accessories\",\"units_sold\":1165},{\"period\":\"2025-06-01\",\"product_category\":\"Computers\",\"units_sold\":3156},{\"period\":\"2025-06-01\",\"product_category\":\"Electronics\",\"units_sold\":4023},{\"period\":\"2025-06-01\",\"product_category\":\"Peripherals\",\"units_sold\":2770},{\"period\":\"2025-06-01\",\"product_category\":\"Wearables\",\"units_sold\":1236},{\"period\":\"2025-07-01\",\"product_category\":\"Accessories\",\"units_sold\":1561},{\"period\":\"2025-07-01\",\"product_category\":\"Computers\",\"units_sold\":3856},{\"period\":\"2025-07-01\",\"product_category\":\"Electronics\",\"units_sold\":4288},{\"period\":\"2025-07-01\",\"product_category\":\"Peripherals\",\"units_sold\":3163},{\"period\":\"2025-07-01\",\"product_category\":\"Wearables\",\"units_sold\":1187},{\"period\":\"2025-08-01\",\"product_category\":\"Wearables\",\"units_sold\":1085},{\"period\":\"2025-08-01\",\"product_category\":\"Electronics\",\"units_sold\":4350},{\"period\":\"2025-08-01\",\"product_category\":\"Peripherals\",\"units_sold\":3151},{\"period\":\"2025-08-01\",\"product_category\":\"Accessories\",\"units_sold\":1417},{\"period\":\"2025-08-01\",\"product_category\":\"Computers\",\"units_sold\":3439},{\"period\":\"2025-09-01\",\"product_category\":\"Accessories\",\"units_sold\":2117},{\"period\":\"2025-09-01\",\"product_category\":\"Computers\",\"units_sold\":4743},{\"period\":\"2025-09-01\",\"product_category\":\"Electronics\",\"units_sold\":5542},{\"period\":\"2025-09-01\",\"product_category\":\"Peripherals\",\"units_sold\":4320},{\"period\":\"2025-09-01\",\"product_category\":\"Wearables\",\"units_sold\":1928},{\"period\":\"2025-10-01\",\"product_category\":\"Computers\",\"units_sold\":7172},{\"period\":\"2025-10-01\",\"product_category\":\"Accessories\",\"units_sold\":3881},{\"period\":\"2025-10-01\",\"product_category\":\"Electronics\",\"units_sold\":8044},{\"period\":\"2025-10-01\",\"product_category\":\"Peripherals\",\"units_sold\":5980},{\"period\":\"2025-10-01\",\"product_category\":\"Wearables\",\"units_sold\":3482},{\"period\":\"2025-11-01\",\"product_category\":\"Electronics\",\"units_sold\":2405},{\"period\":\"2025-11-01\",\"product_category\":\"Peripherals\",\"units_sold\":1541},{\"period\":\"2025-11-01\",\"product_category\":\"Accessories\",\"units_sold\":853},{\"period\":\"2025-11-01\",\"product_category\":\"Computers\",\"units_sold\":1563},{\"period\":\"2025-11-01\",\"product_category\":\"Wearables\",\"units_sold\":797}]\n```", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:29:47.960+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=5284)", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:30:09.226+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 2084, "completion_tokens": 1536, "total_tokens": 3620, "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:30:09.226+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=4933)", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:30:09.228+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:30:09.228+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=2159):\n{'data': [{'type': 'scatter', 'mode': 'lines+markers', 'name': 'Accessories', 'x': ['2024-11-01', '2024-12-01', '2025-01-01', '2025-02-01', '2025-03-01', '2025-04-01', '2025-05-01', '2025-06-01', '2025-07-01', '2025-08-01', '2025-09-01', '2025-10-01', '2025-11-01'], 'y': [600, 1395, 1267, 1277, 1396, 1591, 1294, 1165, 1561, 1417, 2117, 3881, 853], 'line': {'color': '#1f77b4'}}, {'type': 'scatter', 'mode': 'lines+markers', 'name': 'Computers', 'x': ['2024-11-01', '2024-12-01', '2025-01-01', '2025-02-01', '2025-03-01', '2025-04-01', '2025-05-01', '2025-06-01', '2025-07-01', '2025-08-01', '2025-09-01', '2025-10-01', '2025-11-01'], 'y': [1560, 3787, 3505, 3424, 3708, 3747, 3918, 3156, 3856, 3439, 4743, 7172, 1563], 'line': {'color': '#ff7f0e'}}, {'type': 'scatter', 'mode': 'lines+markers', 'name': 'Electronics', 'x': ['2024-11-01', '2024-12-01', '2025-01-01', '2025-02-01', '2025-03-01', '2025-04-01', '2025-05-01', '2025-06-01', '2025-07-01', '2025-08-01', '2025-09-01', '2025-10-01', '2025-11-01'], 'y': [1890, 4290, 3984, 3557, 3973, 4287, 4301, 4023, 4288, 4350, 5542, 8044, 2405], 'line': {'color': '#2ca02c'}}, {'type': 'scatter', 'mode': 'lines+markers', 'name': 'Peripherals', 'x': ['2024-11-01', '2024-12-01', '2025-01-01', '2025-02-01', '2025-03-01', '2025-04-01', '2025-05-01', '2025-06-01', '2025-07-01', '2025-08-01', '2025-09-01', '2025-10-01', '2025-11-01'], 'y': [1227, 3017, 3015, 2659, 3198, 2899, 2906, 2770, 3163, 3151, 4320, 5980, 1541], 'line': {'color': '#d62728'}}, {'... (truncated)", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:30:09.229+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"Accessories\", \"x\": [\"2024-11-01\", \"2024-12-01\", \"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [600, 1395, 1267, 1277, 1396, 1591, 1294, 1165, 1561, 1417, 2117, 3881, 853], \"line\": {\"color\": \"#1f77b4\"}}, {\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"Computers\", \"x\": [\"2024-11-01\", \"2024-12-01\", \"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [1560, 3787, 3505, 3424, 3708, 3747, 3918, 3156, 3856, 3439, 4743, 7172, 1563], \"line\": {\"color\": \"#ff7f0e\"}}, {\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"Electronics\", \"x\": [\"2024-11-01\", \"2024-12-01\", \"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [1890, 4290, 3984, 3557, 3973, 4287, 4301, 4023, 4288, 4350, 5542, 8044, 2405], \"line\": {\"color\": \"#2ca02c\"}}, {\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"Peripherals\", \"x\": [\"2024-11-01\", \"2024-12-01\", \"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [1227, 3017, 3015, 2659, 3198, 2899, 2906, 2770, 3163, 3151, 4320, 5980, 1541], \"line\": {\"color\": \"#d62728\"}}, {\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"Wearables\", \"x\": [\"2024-11-01\", \"2024-12-01\", \"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [553, 1283, 1320, 1157, 1095, 1139, 1158, 1236, 1187, 1085, 1928, 3482, 797], \"line\": {\"color\": \"#9467bd\"}}], \"layout\": {\"title\": {\"text\": \"Units Sold Over Time by Product Category\"}, \"xaxis\": {\"title\": \"Month\", \"type\": \"date\", \"tickformat\": \"%Y-%m\"}, \"yaxis\": {\"title\": \"Units Sold\"}, \"legend\": {\"x\": 1, \"y\": 1, \"xanchor\": \"right\", \"yanchor\": \"top\"}, \"margin\": {\"l\": 60, \"r\": 120, \"t\": 60, \"b\": 60}}}", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:30:09.230+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/b63e0ff814ae.json", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:30:09.234+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:30:09.235+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:30:09.237+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:30:09.240+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:30:09.243+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:30:09.248+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:30:09.250+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:30:09.250+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "Show the trend of units sold for each product category over the past year.", "has_chart": true, "has_narrative": true, "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:30:09.252+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 2159, "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:30:09.253+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 720, "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:30:09.253+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "b63e0ff814ae"}
{"timestamp": "2025-11-18T01:30:20.576+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "Which salesperson achieved the highest profit margin this month?", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:20.580+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:20.591+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:20.594+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=64)", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:20.594+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:23.332+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:23.332+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='Which salesperson achieved the highest profit margin this month?', metrics=['gross_margin'], dimensions=['salesperson'], time_grain='monthly', time_range='this_month', filters=[], sort='-gross_margin', top_k=1, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['Bar chart showing salespersons on the x-axis and their gross margin on the y-axis.', 'Sort bars descending by gross margin.', 'Highlight the top salesperson with the highest gross margin.', 'Time filter set to this month.']), chart_figure_json=None, narrative=None)]", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:23.334+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:23.334+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:23.335+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:23.336+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:23.338+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:23.339+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:23.340+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:23.341+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['gross_margin'] dims=['salesperson']", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:23.342+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:28.403+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4005, "completion_tokens": 276, "total_tokens": 4281, "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:28.404+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=1067)", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:28.404+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=1067)", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:28.405+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:28.406+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=1067):\nWITH base AS (\n  SELECT\n    fact_sales.salesperson_sk,\n    dim_salesperson.salesperson_name,\n    COALESCE(fact_sales.revenue, fact_sales.quantity * fact_sales.unit_price) - COALESCE(fact_sales.sales_cost, 0) AS gross_margin\n  FROM public.fact_sales\n  JOIN public.dim_salesperson ON fact_sales.salesperson_sk = dim_salesperson.salesperson_sk\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE date_trunc('month', dim_date.date) = date_trunc('month', CURRENT_DATE)\n),\nagg AS (\n  SELECT\n    date_trunc('month', dim_date.date)::date AS period,\n    salesperson_name,\n    SUM(gross_margin) AS gross_margin\n  FROM base\n  JOIN public.fact_sales ON base.salesperson_sk = fact_sales.salesperson_sk\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  GROUP BY 1, 2\n),\nranked AS (\n  SELECT\n    period,\n    salesperson_name,\n    gross_margin,\n    ROW_NUMBER() OVER (ORDER BY gross_margin DESC) AS rn\n  FROM agg\n)\nSELECT\n  period,\n  salesperson_name AS salesperson,\n  gross_margin\nFROM ranked\nWHERE rn <= 1\nORDER BY period ASC, gross_margin DESC;", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:28.407+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:28.445+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:28.445+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:28.446+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:28.447+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:28.952+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=1, cols=3)", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:28.952+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=1, cols=3)", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:28.956+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (1, 3)", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:28.959+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:28.963+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: Which salesperson achieved the highest profit margin this month?", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:28.964+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['Bar chart showing salespersons on the x-axis and their gross margin on the y-axis.', 'Sort bars descending by gross margin.', 'Highlight the top salesperson with the highest gross margin.', 'Time filter set to this month.']}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"period\":\"2025-10-01\",\"salesperson\":\"Jordan Diaz\",\"gross_margin\":221537826.2299999893}]\n```", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:28.964+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=504)", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:35.448+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 688, "completion_tokens": 391, "total_tokens": 1079, "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:35.448+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=1460)", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:35.450+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:35.450+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=594):\n{'data': [{'type': 'bar', 'x': ['Jordan Diaz'], 'y': [221537826.23], 'marker': {'color': ['#FF4136']}, 'name': 'Gross Margin', 'hovertemplate': 'Salesperson: Jordan Diaz<br>Gross Margin: $221,537,826.23<extra></extra>'}], 'layout': {'title': {'text': 'Gross Margin by Salesperson (This Month)', 'x': 0.5}, 'xaxis': {'title': 'Salesperson', 'categoryorder': 'array', 'categoryarray': ['Jordan Diaz']}, 'yaxis': {'title': 'Gross Margin', 'tickformat': '$,.2f'}, 'legend': {'orientation': 'v', 'yanchor': 'top', 'y': 1, 'xanchor': 'right', 'x': 1}, 'margin': {'t': 50, 'b': 50, 'l': 70, 'r': 70}}}", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:35.450+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"bar\", \"x\": [\"Jordan Diaz\"], \"y\": [221537826.23], \"marker\": {\"color\": [\"#FF4136\"]}, \"name\": \"Gross Margin\", \"hovertemplate\": \"Salesperson: Jordan Diaz<br>Gross Margin: $221,537,826.23<extra></extra>\"}], \"layout\": {\"title\": {\"text\": \"Gross Margin by Salesperson (This Month)\", \"x\": 0.5}, \"xaxis\": {\"title\": \"Salesperson\", \"categoryorder\": \"array\", \"categoryarray\": [\"Jordan Diaz\"]}, \"yaxis\": {\"title\": \"Gross Margin\", \"tickformat\": \"$,.2f\"}, \"legend\": {\"orientation\": \"v\", \"yanchor\": \"top\", \"y\": 1, \"xanchor\": \"right\", \"x\": 1}, \"margin\": {\"t\": 50, \"b\": 50, \"l\": 70, \"r\": 70}}}", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:35.451+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/d082a13b00a5.json", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:35.454+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:35.454+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:35.456+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:35.459+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:35.461+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:35.463+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:35.464+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:35.464+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "Which salesperson achieved the highest profit margin this month?", "has_chart": true, "has_narrative": true, "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:35.466+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 594, "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:35.467+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 516, "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:35.467+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "d082a13b00a5"}
{"timestamp": "2025-11-18T01:30:44.743+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "List the top 5 customers by total income year to date.", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:44.747+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:44.757+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:44.761+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=54)", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:44.761+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:48.145+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:48.145+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='List the top 5 customers by total income year to date.', metrics=['actual_revenue'], dimensions=['customer'], time_grain='AllPeriods', time_range='YTD', filters=[], sort='-actual_revenue', top_k=5, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['bar chart', 'x-axis: customer', 'y-axis: actual_revenue', 'show top 5 customers by actual_revenue', 'time range: year to date']), chart_figure_json=None, narrative=None)]", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:48.147+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:48.147+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:48.148+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:48.149+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:48.150+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:48.151+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:48.151+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:48.152+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['actual_revenue'] dims=['customer']", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:48.153+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:51.408+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4012, "completion_tokens": 173, "total_tokens": 4185, "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:51.408+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=673)", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:51.408+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=673)", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:51.410+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:51.410+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=673):\nWITH base AS (\n  SELECT\n    fact_sales.customer_sk,\n    dim_customer.customer_name,\n    COALESCE(fact_sales.revenue, fact_sales.quantity * fact_sales.unit_price) AS actual_revenue\n  FROM public.fact_sales\n  JOIN public.dim_customer ON fact_sales.customer_sk = dim_customer.customer_sk\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE date_trunc('year', dim_date.date) = date_trunc('year', CURRENT_DATE)\n    AND dim_date.date <= CURRENT_DATE\n)\n, agg AS (\n  SELECT\n    customer_name,\n    SUM(actual_revenue) AS actual_revenue\n  FROM base\n  GROUP BY 1\n)\nSELECT\n  customer_name AS customer,\n  actual_revenue\nFROM agg\nORDER BY actual_revenue DESC\nLIMIT 5;", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:51.412+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:51.449+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:51.449+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:51.451+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:51.452+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:51.530+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=5, cols=2)", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:51.530+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=5, cols=2)", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:51.532+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (5, 2)", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:51.533+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:51.536+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: List the top 5 customers by total income year to date.", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:51.536+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['bar chart', 'x-axis: customer', 'y-axis: actual_revenue', 'show top 5 customers by actual_revenue', 'time range: year to date']}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"customer\":\"Stark Procurement\",\"actual_revenue\":13465382.5999999996},{\"customer\":\"Hooli Ventures\",\"actual_revenue\":13082157.7899999991},{\"customer\":\"Umbrella Group\",\"actual_revenue\":12364650.8300000001},{\"customer\":\"Globex Corp\",\"actual_revenue\":11716903.3000000007},{\"customer\":\"Nimbus Online\",\"actual_revenue\":10607610.9499999993}]\n```", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:30:51.536+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=654)", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:31:00.012+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 745, "completion_tokens": 434, "total_tokens": 1179, "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:31:00.012+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=1613)", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:31:00.014+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:31:00.014+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=570):\n{'data': [{'type': 'bar', 'x': ['Stark Procurement', 'Hooli Ventures', 'Umbrella Group', 'Globex Corp', 'Nimbus Online'], 'y': [13465382.6, 13082157.79, 12364650.83, 11716903.3, 10607610.95], 'name': 'Actual Revenue', 'marker': {'color': '#1f77b4'}}], 'layout': {'title': {'text': 'Top 5 Customers by Actual Revenue (Year to Date)', 'x': 0.5}, 'xaxis': {'title': 'Customer', 'type': 'category'}, 'yaxis': {'title': 'Actual Revenue', 'tickformat': ',.0f'}, 'legend': {'x': 1, 'y': 1, 'xanchor': 'right', 'yanchor': 'top'}, 'margin': {'t': 50, 'b': 50, 'l': 70, 'r': 50}}}", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:31:00.014+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"bar\", \"x\": [\"Stark Procurement\", \"Hooli Ventures\", \"Umbrella Group\", \"Globex Corp\", \"Nimbus Online\"], \"y\": [13465382.6, 13082157.79, 12364650.83, 11716903.3, 10607610.95], \"name\": \"Actual Revenue\", \"marker\": {\"color\": \"#1f77b4\"}}], \"layout\": {\"title\": {\"text\": \"Top 5 Customers by Actual Revenue (Year to Date)\", \"x\": 0.5}, \"xaxis\": {\"title\": \"Customer\", \"type\": \"category\"}, \"yaxis\": {\"title\": \"Actual Revenue\", \"tickformat\": \",.0f\"}, \"legend\": {\"x\": 1, \"y\": 1, \"xanchor\": \"right\", \"yanchor\": \"top\"}, \"margin\": {\"t\": 50, \"b\": 50, \"l\": 70, \"r\": 50}}}", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:31:00.015+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/ddeaaeca94b0.json", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:31:00.020+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:31:00.020+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:31:00.022+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:31:00.025+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:31:00.026+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:31:00.029+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:31:00.031+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:31:00.032+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "List the top 5 customers by total income year to date.", "has_chart": true, "has_narrative": true, "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:31:00.034+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 570, "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:31:00.034+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 597, "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:31:00.035+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "ddeaaeca94b0"}
{"timestamp": "2025-11-18T01:31:25.477+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "What were our total income and profit by month over the last 90 days?", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:25.481+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:25.491+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:25.496+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=69)", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:25.496+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:29.077+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:29.077+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='What were our total income and profit by month over the last 90 days?', metrics=['actual_revenue', 'gross_margin'], dimensions=['month'], time_grain='monthly', time_range='past_90_days', filters=[], sort=None, top_k=None, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['Use a line chart to show total income (actual_revenue) and profit (gross_margin) by month over the last 90 days.', 'Plot two lines, one for actual_revenue and one for gross_margin.', 'Label the x-axis as Month and y-axis as Amount.', 'Include a legend to distinguish income and profit.']), chart_figure_json=None, narrative=None)]", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:29.080+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:29.080+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:29.080+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:29.081+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:29.082+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:29.083+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:29.083+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:29.084+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['actual_revenue', 'gross_margin'] dims=['month']", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:29.084+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:32.479+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4019, "completion_tokens": 190, "total_tokens": 4209, "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:32.479+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=713)", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:32.479+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=713)", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:32.481+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:32.481+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=713):\nWITH base AS (\n  SELECT\n    fact_sales.sale_id,\n    fact_sales.revenue,\n    fact_sales.quantity,\n    fact_sales.unit_price,\n    fact_sales.sales_cost,\n    dim_date.date\n  FROM public.fact_sales\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE dim_date.date >= CURRENT_DATE - interval '90 days'\n),\nagg AS (\n  SELECT\n    date_trunc('month', base.date)::date AS period,\n    SUM(COALESCE(base.revenue, base.quantity * base.unit_price)) AS actual_revenue,\n    SUM(COALESCE(base.revenue, base.quantity * base.unit_price) - COALESCE(base.sales_cost, 0)) AS gross_margin\n  FROM base\n  GROUP BY 1\n)\nSELECT\n  period,\n  actual_revenue,\n  gross_margin\nFROM agg\nORDER BY actual_revenue DESC, period ASC;", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:32.483+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:32.520+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:32.520+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:32.522+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:32.524+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:32.597+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=4, cols=3)", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:32.598+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=4, cols=3)", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:32.600+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (4, 3)", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:32.601+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:32.604+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: What were our total income and profit by month over the last 90 days?", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:32.604+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['Use a line chart to show total income (actual_revenue) and profit (gross_margin) by month over the last 90 days.', 'Plot two lines, one for actual_revenue and one for gross_margin.', 'Label the x-axis as Month and y-axis as Amount.', 'Include a legend to distinguish income and profit.']}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"period\":\"2025-08-01\",\"actual_revenue\":3700692.7799999998,\"gross_margin\":3693111.98},{\"period\":\"2025-09-01\",\"actual_revenue\":11839221.5199999996,\"gross_margin\":11809156.0700000003},{\"period\":\"2025-10-01\",\"actual_revenue\":15429808.6999999993,\"gross_margin\":15384281.3599999994},{\"period\":\"2025-11-01\",\"actual_revenue\":4042539.2599999998,\"gross_margin\":4031057.6299999999}]\n```", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:32.605+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=852)", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:41.275+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 816, "completion_tokens": 563, "total_tokens": 1379, "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:41.275+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=1815)", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:41.276+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:41.276+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=897):\n{'data': [{'type': 'scatter', 'mode': 'lines+markers', 'name': 'actual_revenue', 'x': ['2025-08-01', '2025-09-01', '2025-10-01', '2025-11-01'], 'y': [3700692.78, 11839221.52, 15429808.7, 4042539.26], 'line': {'color': '#1f77b4'}, 'hovertemplate': 'Month: %{x}<br>Amount: %{y:.2f}<extra>actual_revenue</extra>'}, {'type': 'scatter', 'mode': 'lines+markers', 'name': 'gross_margin', 'x': ['2025-08-01', '2025-09-01', '2025-10-01', '2025-11-01'], 'y': [3693111.98, 11809156.07, 15384281.36, 4031057.63], 'line': {'color': '#ff7f0e'}, 'hovertemplate': 'Month: %{x}<br>Amount: %{y:.2f}<extra>gross_margin</extra>'}], 'layout': {'xaxis': {'title': 'Month', 'type': 'date', 'tickformat': '%Y-%m', 'showgrid': True}, 'yaxis': {'title': 'Amount', 'showgrid': True}, 'legend': {'x': 1, 'y': 1, 'xanchor': 'right', 'yanchor': 'top'}, 'margin': {'l': 60, 'r': 40, 't': 40, 'b': 60}, 'hovermode': 'x unified'}}", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:41.276+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"actual_revenue\", \"x\": [\"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [3700692.78, 11839221.52, 15429808.7, 4042539.26], \"line\": {\"color\": \"#1f77b4\"}, \"hovertemplate\": \"Month: %{x}<br>Amount: %{y:.2f}<extra>actual_revenue</extra>\"}, {\"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": \"gross_margin\", \"x\": [\"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [3693111.98, 11809156.07, 15384281.36, 4031057.63], \"line\": {\"color\": \"#ff7f0e\"}, \"hovertemplate\": \"Month: %{x}<br>Amount: %{y:.2f}<extra>gross_margin</extra>\"}], \"layout\": {\"xaxis\": {\"title\": \"Month\", \"type\": \"date\", \"tickformat\": \"%Y-%m\", \"showgrid\": true}, \"yaxis\": {\"title\": \"Amount\", \"showgrid\": true}, \"legend\": {\"x\": 1, \"y\": 1, \"xanchor\": \"right\", \"yanchor\": \"top\"}, \"margin\": {\"l\": 60, \"r\": 40, \"t\": 40, \"b\": 60}, \"hovermode\": \"x unified\"}}", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:41.276+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/dfea1e7674bb.json", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:41.278+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:41.278+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:41.278+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:41.279+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:41.280+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:41.281+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:41.281+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:41.282+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "What were our total income and profit by month over the last 90 days?", "has_chart": true, "has_narrative": true, "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:41.283+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 897, "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:41.283+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 574, "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:31:41.283+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "dfea1e7674bb"}
{"timestamp": "2025-11-18T01:32:52.026+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "Whats the day-by-day revenue trend for this month?", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:52.030+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:52.040+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:52.044+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=51)", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:52.044+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:54.601+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:54.601+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='Whats the day-by-day revenue trend for this month?', metrics=['actual_revenue'], dimensions=['date'], time_grain='daily', time_range='this_month', filters=[], sort=None, top_k=None, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['Use a line chart to show actual_revenue over time.', 'X-axis is date with daily granularity for this month.', 'Y-axis is actual_revenue.', \"Title the chart 'Day-by-day Revenue Trend for This Month'.\"]), chart_figure_json=None, narrative=None)]", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:54.605+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:54.605+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:54.606+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:54.606+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:54.608+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:54.609+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:54.609+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:54.610+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['actual_revenue'] dims=['date']", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:54.611+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:57.202+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4009, "completion_tokens": 149, "total_tokens": 4158, "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:57.203+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=542)", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:57.203+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=542)", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:57.203+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:57.203+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=542):\nWITH base AS (\n  SELECT\n    dim_date.date,\n    COALESCE(fact_sales.revenue, fact_sales.quantity * fact_sales.unit_price) AS actual_revenue\n  FROM public.fact_sales\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE date_trunc('month', dim_date.date) = date_trunc('month', CURRENT_DATE)\n),\nagg AS (\n  SELECT\n    date_trunc('day', base.date)::date AS period,\n    SUM(base.actual_revenue) AS actual_revenue\n  FROM base\n  GROUP BY 1\n)\nSELECT\n  period AS date,\n  actual_revenue\nFROM agg\nORDER BY actual_revenue DESC, date ASC;", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:57.204+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:57.224+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:57.224+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:57.225+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:57.226+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:57.278+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=7, cols=2)", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:57.278+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=7, cols=2)", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:57.279+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (7, 2)", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:57.280+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:57.281+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: Whats the day-by-day revenue trend for this month?", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:57.281+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['Use a line chart to show actual_revenue over time.', 'X-axis is date with daily granularity for this month.', 'Y-axis is actual_revenue.', \"Title the chart 'Day-by-day Revenue Trend for This Month'.\"]}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"date\":\"2025-11-01\",\"actual_revenue\":314790.59},{\"date\":\"2025-11-02\",\"actual_revenue\":270717.14},{\"date\":\"2025-11-03\",\"actual_revenue\":541197.7},{\"date\":\"2025-11-04\",\"actual_revenue\":680878.12},{\"date\":\"2025-11-05\",\"actual_revenue\":708854.4300000001},{\"date\":\"2025-11-06\",\"actual_revenue\":779198.53},{\"date\":\"2025-11-07\",\"actual_revenue\":746902.75}]\n```", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:32:57.281+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=743)", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:33:04.949+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 792, "completion_tokens": 481, "total_tokens": 1273, "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:33:04.950+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=1466)", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:33:04.951+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:33:04.952+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=679):\n{'data': [{'type': 'scatter', 'mode': 'lines+markers', 'x': ['2025-11-01', '2025-11-02', '2025-11-03', '2025-11-04', '2025-11-05', '2025-11-06', '2025-11-07'], 'y': [314790.59, 270717.14, 541197.7, 680878.12, 708854.43, 779198.53, 746902.75], 'name': 'actual_revenue', 'line': {'color': '#1f77b4'}, 'marker': {'color': '#1f77b4'}}], 'layout': {'title': {'text': 'Day-by-day Revenue Trend for This Month', 'x': 0.5}, 'xaxis': {'title': 'date', 'type': 'date', 'tickformat': '%Y-%m-%d', 'tickangle': -45}, 'yaxis': {'title': 'actual_revenue', 'tickformat': ',.2f'}, 'legend': {'x': 1, 'y': 1, 'xanchor': 'right', 'yanchor': 'top'}, 'margin': {'t': 50, 'b': 100, 'l': 70, 'r': 70}}}", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:33:04.952+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"scatter\", \"mode\": \"lines+markers\", \"x\": [\"2025-11-01\", \"2025-11-02\", \"2025-11-03\", \"2025-11-04\", \"2025-11-05\", \"2025-11-06\", \"2025-11-07\"], \"y\": [314790.59, 270717.14, 541197.7, 680878.12, 708854.43, 779198.53, 746902.75], \"name\": \"actual_revenue\", \"line\": {\"color\": \"#1f77b4\"}, \"marker\": {\"color\": \"#1f77b4\"}}], \"layout\": {\"title\": {\"text\": \"Day-by-day Revenue Trend for This Month\", \"x\": 0.5}, \"xaxis\": {\"title\": \"date\", \"type\": \"date\", \"tickformat\": \"%Y-%m-%d\", \"tickangle\": -45}, \"yaxis\": {\"title\": \"actual_revenue\", \"tickformat\": \",.2f\"}, \"legend\": {\"x\": 1, \"y\": 1, \"xanchor\": \"right\", \"yanchor\": \"top\"}, \"margin\": {\"t\": 50, \"b\": 100, \"l\": 70, \"r\": 70}}}", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:33:04.954+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/e0c22ca0aa8d.json", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:33:04.958+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:33:04.958+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:33:04.962+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:33:04.965+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:33:04.967+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:33:04.971+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:33:04.974+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:33:04.974+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "Whats the day-by-day revenue trend for this month?", "has_chart": true, "has_narrative": true, "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:33:04.976+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 679, "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:33:04.976+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 513, "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:33:04.976+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "e0c22ca0aa8d"}
{"timestamp": "2025-11-18T01:33:45.211+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "Which product category underperformed against its budget last month?", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:45.214+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:45.223+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:45.227+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=68)", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:45.227+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:48.793+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:48.793+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='Which product category underperformed against its budget last month?', metrics=['actual_revenue', 'budget_revenue'], dimensions=['product_category'], time_grain='monthly', time_range='last_month', filters=[], sort='-actual_revenue', top_k=None, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['Bar chart showing product categories on the x-axis and revenue on the y-axis.', 'Include two bars per category: actual revenue and budget revenue.', 'Highlight categories where actual revenue is less than budget revenue.', 'Sort categories by difference between actual and budget revenue ascending (underperforming first).', 'Title: Product Categories Underperforming Against Budget Last Month.', 'Legend for actual vs budget revenue.']), chart_figure_json=None, narrative=None)]", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:48.797+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:48.797+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:48.798+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:48.799+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:48.801+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:48.802+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:48.803+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:48.803+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['actual_revenue', 'budget_revenue'] dims=['product_category']", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:48.805+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:52.860+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4014, "completion_tokens": 214, "total_tokens": 4228, "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:52.860+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=821)", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:52.860+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=821)", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:52.862+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:52.862+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=821):\nWITH base AS (\n  SELECT\n    dim_product.category AS product_category,\n    COALESCE(fact_sales.revenue, fact_sales.quantity * fact_sales.unit_price) AS actual_revenue,\n    fact_sales.budget_revenue AS budget_revenue,\n    dim_date.date AS date\n  FROM public.fact_sales\n  JOIN public.dim_product ON fact_sales.product_sk = dim_product.product_sk\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE date_trunc('month', dim_date.date) = date_trunc('month', CURRENT_DATE) - interval '1 month'\n),\nagg AS (\n  SELECT\n    date_trunc('month', date)::date AS period,\n    product_category,\n    SUM(actual_revenue) AS actual_revenue,\n    SUM(budget_revenue) AS budget_revenue\n  FROM base\n  GROUP BY 1, 2\n)\nSELECT\n  product_category,\n  actual_revenue,\n  budget_revenue,\n  period\nFROM agg\nORDER BY actual_revenue ASC;", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:52.863+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:52.904+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:52.904+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:52.906+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:52.907+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:52.983+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=5, cols=4)", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:52.983+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=5, cols=4)", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:52.986+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (5, 4)", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:52.987+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:52.989+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: Which product category underperformed against its budget last month?", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:52.989+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['Bar chart showing product categories on the x-axis and revenue on the y-axis.', 'Include two bars per category: actual revenue and budget revenue.', 'Highlight categories where actual revenue is less than budget revenue.', 'Sort categories by difference between actual and budget revenue ascending (underperforming first).', 'Title: Product Categories Underperforming Against Budget Last Month.', 'Legend for actual vs budget revenue.']}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"product_category\":\"Accessories\",\"actual_revenue\":587657.89,\"budget_revenue\":590845.0,\"period\":\"2025-10-01\"},{\"product_category\":\"Wearables\",\"actual_revenue\":778457.6,\"budget_revenue\":783860.0,\"period\":\"2025-10-01\"},{\"product_category\":\"Peripherals\",\"actual_revenue\":1397343.73,\"budget_revenue\":1404834.0,\"period\":\"2025-10-01\"},{\"product_category\":\"Electronics\",\"actual_revenue\":5322111.5800000001,\"budget_revenue\":5383350.0,\"period\":\"2025-10-01\"},{\"product_category\":\"Computers\",\"actual_revenue\":7344237.9000000004,\"budget_revenue\":7349052.0,\"period\":\"2025-10-01\"}]\n```", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:33:52.990+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=1196)", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:34:01.356+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 873, "completion_tokens": 573, "total_tokens": 1446, "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:34:01.356+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=2324)", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:34:01.357+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:34:01.357+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=915):\n{'data': [{'type': 'bar', 'name': 'Actual Revenue', 'x': ['Accessories', 'Wearables', 'Peripherals', 'Electronics', 'Computers'], 'y': [587657.89, 778457.6, 1397343.73, 5322111.58, 7344237.9], 'marker': {'color': ['red', 'red', 'red', 'red', 'red']}}, {'type': 'bar', 'name': 'Budget Revenue', 'x': ['Accessories', 'Wearables', 'Peripherals', 'Electronics', 'Computers'], 'y': [590845, 783860, 1404834, 5383350, 7349052], 'marker': {'color': 'rgba(0,0,255,0.6)'}}], 'layout': {'title': {'text': 'Product Categories Underperforming Against Budget Last Month', 'x': 0.5}, 'barmode': 'group', 'xaxis': {'title': 'Product Categories', 'categoryorder': 'array', 'categoryarray': ['Accessories', 'Wearables', 'Peripherals', 'Electronics', 'Computers']}, 'yaxis': {'title': 'Revenue', 'tickformat': ',.0f'}, 'legend': {'x': 1, 'y': 1, 'xanchor': 'left', 'yanchor': 'top'}, 'margin': {'t': 50, 'b': 50, 'l': 70, 'r': 150}}}", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:34:01.357+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"bar\", \"name\": \"Actual Revenue\", \"x\": [\"Accessories\", \"Wearables\", \"Peripherals\", \"Electronics\", \"Computers\"], \"y\": [587657.89, 778457.6, 1397343.73, 5322111.58, 7344237.9], \"marker\": {\"color\": [\"red\", \"red\", \"red\", \"red\", \"red\"]}}, {\"type\": \"bar\", \"name\": \"Budget Revenue\", \"x\": [\"Accessories\", \"Wearables\", \"Peripherals\", \"Electronics\", \"Computers\"], \"y\": [590845, 783860, 1404834, 5383350, 7349052], \"marker\": {\"color\": \"rgba(0,0,255,0.6)\"}}], \"layout\": {\"title\": {\"text\": \"Product Categories Underperforming Against Budget Last Month\", \"x\": 0.5}, \"barmode\": \"group\", \"xaxis\": {\"title\": \"Product Categories\", \"categoryorder\": \"array\", \"categoryarray\": [\"Accessories\", \"Wearables\", \"Peripherals\", \"Electronics\", \"Computers\"]}, \"yaxis\": {\"title\": \"Revenue\", \"tickformat\": \",.0f\"}, \"legend\": {\"x\": 1, \"y\": 1, \"xanchor\": \"left\", \"yanchor\": \"top\"}, \"margin\": {\"t\": 50, \"b\": 50, \"l\": 70, \"r\": 150}}}", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:34:01.359+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/5515e06cd441.json", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:34:01.364+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:34:01.364+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:34:01.365+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:34:01.367+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:34:01.368+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:34:01.372+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:34:01.374+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:34:01.374+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "Which product category underperformed against its budget last month?", "has_chart": true, "has_narrative": true, "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:34:01.376+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 915, "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:34:01.377+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 623, "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:34:01.377+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "5515e06cd441"}
{"timestamp": "2025-11-18T01:34:39.758+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "Which region exceeded its sales targets last quarter?", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:39.761+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:39.772+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:39.776+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=53)", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:39.777+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:44.484+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:44.484+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='Which region exceeded its sales targets last quarter?', metrics=['actual_revenue', 'budget_revenue'], dimensions=['region'], time_grain='quarterly', time_range='last_year', filters=[], sort=None, top_k=None, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['Bar chart showing regions on x-axis and actual vs budget revenue on y-axis for last quarter', 'Highlight regions where actual revenue exceeds budget revenue', 'Title: Regions Exceeding Sales Targets Last Quarter', 'Legend for Actual Revenue and Budget Revenue']), chart_figure_json=None, narrative=None)]", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:44.488+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:44.488+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:44.490+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:44.490+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:44.492+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:44.492+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:44.493+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:44.493+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['actual_revenue', 'budget_revenue'] dims=['region']", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:44.494+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:49.487+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4012, "completion_tokens": 286, "total_tokens": 4298, "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:49.487+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=1112)", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:49.487+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=1112)", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:49.489+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:49.489+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=1112):\nWITH base AS (\n  SELECT\n    fact_sales.revenue,\n    fact_sales.quantity,\n    fact_sales.unit_price,\n    fact_sales.budget_revenue,\n    fact_sales.sales_cost,\n    dim_region.region_name\n  FROM public.fact_sales\n  JOIN public.dim_region ON fact_sales.region_sk = dim_region.region_sk\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE date_trunc('year', dim_date.date) = date_trunc('year', CURRENT_DATE) - interval '1 year'\n),\nagg AS (\n  SELECT\n    date_trunc('quarter', dim_date.date)::date AS period,\n    base.region_name,\n    SUM(COALESCE(base.revenue, base.quantity * base.unit_price)) AS actual_revenue,\n    SUM(base.budget_revenue) AS budget_revenue\n  FROM base\n  JOIN public.fact_sales ON fact_sales.region_sk = dim_region.region_sk\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  JOIN public.dim_region ON fact_sales.region_sk = dim_region.region_sk\n  GROUP BY 1, 2\n),\nfiltered AS (\n  SELECT *\n  FROM agg\n  WHERE actual_revenue > budget_revenue\n)\nSELECT\n  period,\n  region_name AS region,\n  actual_revenue,\n  budget_revenue\nFROM filtered\nORDER BY actual_revenue DESC;", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:49.492+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:49.529+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: ERR {'code': '42P01', 'message': 'missing FROM-clause entry for table \"dim_region\"'}", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:49.529+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation FAILED: {'code': '42P01', 'message': 'missing FROM-clause entry for table \"dim_region\"'}", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:49.529+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validation attempts: 1", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:54.128+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4032, "completion_tokens": 248, "total_tokens": 4280, "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:54.129+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=943)", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:54.129+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=943)", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:54.129+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:54.130+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=943):\nWITH base AS (\n  SELECT\n    fact_sales.revenue,\n    fact_sales.quantity,\n    fact_sales.unit_price,\n    fact_sales.budget_revenue,\n    fact_sales.sales_cost,\n    dim_region.region_name,\n    dim_date.date\n  FROM public.fact_sales\n  JOIN public.dim_region ON fact_sales.region_sk = dim_region.region_sk\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  WHERE date_trunc('year', dim_date.date) = date_trunc('year', CURRENT_DATE) - interval '1 year'\n),\nagg AS (\n  SELECT\n    date_trunc('quarter', base.date)::date AS period,\n    base.region_name,\n    SUM(COALESCE(base.revenue, base.quantity * base.unit_price)) AS actual_revenue,\n    SUM(base.budget_revenue) AS budget_revenue\n  FROM base\n  GROUP BY 1, 2\n),\nfiltered AS (\n  SELECT *\n  FROM agg\n  WHERE actual_revenue > budget_revenue\n)\nSELECT\n  period,\n  region_name AS region,\n  actual_revenue,\n  budget_revenue\nFROM filtered\nORDER BY actual_revenue DESC, period ASC, region ASC;", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:54.130+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:54.155+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:54.155+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:54.156+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:54.157+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:54.219+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=5, cols=4)", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:54.219+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=5, cols=4)", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:54.221+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (5, 4)", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:54.222+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:54.224+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: Which region exceeded its sales targets last quarter?", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:54.225+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['Bar chart showing regions on x-axis and actual vs budget revenue on y-axis for last quarter', 'Highlight regions where actual revenue exceeds budget revenue', 'Title: Regions Exceeding Sales Targets Last Quarter', 'Legend for Actual Revenue and Budget Revenue']}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"period\":\"2024-07-01\",\"region\":\"EMEA\",\"actual_revenue\":526920.29,\"budget_revenue\":522497.0},{\"period\":\"2024-07-01\",\"region\":\"ANZ\",\"actual_revenue\":433998.17,\"budget_revenue\":419560.0},{\"period\":\"2024-10-01\",\"region\":\"AMER\",\"actual_revenue\":8163015.4699999997,\"budget_revenue\":8119077.0},{\"period\":\"2024-10-01\",\"region\":\"APAC\",\"actual_revenue\":7997054.7999999998,\"budget_revenue\":7986147.0},{\"period\":\"2024-10-01\",\"region\":\"ANZ\",\"actual_revenue\":7596997.4400000004,\"budget_revenue\":7590984.0}]\n```", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:34:54.225+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=947)", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:35:01.052+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 840, "completion_tokens": 468, "total_tokens": 1308, "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:35:01.052+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=1607)", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:35:01.054+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:35:01.054+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=626):\n{'data': [{'type': 'bar', 'name': 'Actual Revenue', 'x': ['AMER', 'APAC', 'ANZ'], 'y': [8163015.47, 7997054.8, 7596997.44], 'marker': {'color': ['#1f77b4', '#1f77b4', '#2ca02c']}}, {'type': 'bar', 'name': 'Budget Revenue', 'x': ['AMER', 'APAC', 'ANZ'], 'y': [8119077, 7986147, 7590984], 'marker': {'color': '#ff7f0e'}}], 'layout': {'title': {'text': 'Regions Exceeding Sales Targets Last Quarter', 'x': 0.5}, 'barmode': 'group', 'xaxis': {'title': 'Region'}, 'yaxis': {'title': 'Revenue', 'tickformat': ',.0f'}, 'legend': {'x': 1, 'y': 1, 'xanchor': 'right', 'yanchor': 'top'}, 'margin': {'t': 50, 'b': 50, 'l': 70, 'r': 70}}}", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:35:01.054+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"bar\", \"name\": \"Actual Revenue\", \"x\": [\"AMER\", \"APAC\", \"ANZ\"], \"y\": [8163015.47, 7997054.8, 7596997.44], \"marker\": {\"color\": [\"#1f77b4\", \"#1f77b4\", \"#2ca02c\"]}}, {\"type\": \"bar\", \"name\": \"Budget Revenue\", \"x\": [\"AMER\", \"APAC\", \"ANZ\"], \"y\": [8119077, 7986147, 7590984], \"marker\": {\"color\": \"#ff7f0e\"}}], \"layout\": {\"title\": {\"text\": \"Regions Exceeding Sales Targets Last Quarter\", \"x\": 0.5}, \"barmode\": \"group\", \"xaxis\": {\"title\": \"Region\"}, \"yaxis\": {\"title\": \"Revenue\", \"tickformat\": \",.0f\"}, \"legend\": {\"x\": 1, \"y\": 1, \"xanchor\": \"right\", \"yanchor\": \"top\"}, \"margin\": {\"t\": 50, \"b\": 50, \"l\": 70, \"r\": 70}}}", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:35:01.055+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/62d4a6e5b8e4.json", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:35:01.059+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:35:01.059+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:35:01.061+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:35:01.063+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:35:01.065+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:35:01.069+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:35:01.070+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:35:01.071+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "Which region exceeded its sales targets last quarter?", "has_chart": true, "has_narrative": true, "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:35:01.073+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 626, "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:35:01.074+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 583, "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:35:01.074+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "62d4a6e5b8e4"}
{"timestamp": "2025-11-18T01:36:52.287+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_started", "user_query": "Show revenue for the Electronics category by month.", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:52.290+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Start processing user query...", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:52.300+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Using system prompt:\nAgent: agent_parser\nRole: A parser that convert user queries into relevant data questions.\nContext: The parser should consider the user's intent and the specific details of their query.\nInstruction:\nYou are a **Request Parser** for a multi-agent analytics assistant.\nUsers may write a paragraph with multiple requests. Your job:\n- Split the input into distinct, atomic questions.\n- Merge similar questions.\n- Rephrase each question to be concise and self-contained.\n- Ensure each question is clear and unambiguous.\n- For each question it must be of kind \"data\".\n- When it's a **data** question, MUST extract:\n  - metrics (exact names if possible and mapped to known metrics provided)\n  - dimensions (group-bys. exact names if possible and mapped to known dimensions provided)\n  - time_grain (daily/weekly/monthly/quarterly/yearly/AllPeriods) if implied, default to \"AllPeriods\" if not specified\n  - time_range (this_year/last_month/past_30_days/this_month/current_month/YTD/MTD/past_3_years/past_2_years/past_12_months/past_24_months or <start>_to_<end>) if implied, default to \"past_3_years\" if not specified\n  - filters (simple expressions)\n  - sort and top_k (e.g., \"top 5 by revenue\" -> sort='-revenue', top_k=5)\n  - you MUST capture a `chart_hint` that follows **chart_hint_instruction** exactly.\n\nOutput MUST be valid JSON matching the provided Pydantic schema.\nBe concise, avoid invented fields, and prefer known metric/dimension names when obvious.\n\n**chart_hint_instruction**:\nProduce a single valid dictionary or instance of ChartHint object under the key `chart_hint` that captures the user's intent (`encoding_rules`) for the chart.\nThe `encoding_rules` should be a list of free-text instructions for the chart renderer. It can include:\n- chart_type (line, bar, area, pie, table, scatter)\n- formatting (e.g., \"$,.0f\", \"%b %Y\")\n- multi-series logic (e.g., \"budget as dashed\", \"colors consistent by metric\")\n- interaction controls (dropdown, multiselect, slider)\n- any special rendering rules (e.g., \"show budget as dashed line\", \"group by product_category\")\n- layout hints (titles, axis labels, legend titles)\n- interaction defaults (e.g., default selected option in dropdown)\n\nFew-Shot Examples:\nExample 1:\nUser Query:\nShow monthly revenue vs budget revenue by product category for this year. Let users pick a single category or \"All\". Use a line chart with Revenue (solid) vs Budget (dashed).\n\nExample Context & Expected Output (YAML):\navailable_fields:\n  dimensions:\n  - product_category\n  - month\n  metrics:\n  - revenue\n  - budget_revenue\n  time_range: this_year\n  time_grain: monthly\nexpected_output:\n  chart_hint:\n    encoding_rules:\n    - Plot one line per metric over time.\n    - Show Revenue as solid and Budget as dashed.\n    - When a single product_category is selected, render exactly two lines for that\n      category.\n    - When \"All\" is selected, overlay all categories; allow legend toggling.\n    - Keep colors consistent by metric across categories; group traces by legendgroup=product_category.\nStyle or Tone:\n- Analytical and precise\nGoal: Provide a list of questions with their types and relevant details extracted and a chart_hint json for each data question.", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:52.305+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: received user_query (len=51)", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:52.305+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parsing user query...", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:55.045+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - 1 work items", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:55.045+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Parser LLM returned - [DataQuestion(kind='data', original_text='Show revenue for the Electronics category by month.', metrics=['actual_revenue'], dimensions=['month'], time_grain='monthly', time_range='past_3_years', filters=[Filter(field='product_category', op='=', value='Electronics')], sort=None, top_k=None, template_id=None, dataset=None, chart_hint=ChartHint(encoding_rules=['Use a line chart to show actual revenue over time by month for the Electronics category.', 'X-axis: month, Y-axis: actual revenue.', 'Filter data to only include product_category = Electronics.', 'Show data aggregated monthly.']), chart_figure_json=None, narrative=None)]", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:55.048+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.parser", "message": "Post-processed items: 1", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:55.048+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parse node: produced 1 work items", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:55.050+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.user_request_parser", "message": "Parser validation: is_valid=True, message=Request is valid.", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:55.051+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_parsing", "message": "run_parsing_node: is_valid=True, validation_message=Request is valid., progress_messages=['Start processing user query...', 'Parsing completed.']", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:55.053+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:55.054+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.init_loop", "message": "Init: 1 DataQuestions, 0 AnalysisRequests", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:55.055+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Parsing completed.", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:55.055+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.pick_next", "message": "Pick DQ #0: metrics=['actual_revenue'] dims=['month']", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:55.056+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Extracting data for question 1 of 1.", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:58.849+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 4016, "completion_tokens": 199, "total_tokens": 4215, "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:58.849+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_generation", "message": "LLM returned SQL (len=762)", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:58.849+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_generate", "message": "SQL generated (len=762)", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:58.851+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL...", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:58.851+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "Validating SQL (len=762):\nWITH base AS (\n  SELECT\n    fact_sales.revenue,\n    fact_sales.quantity,\n    fact_sales.unit_price,\n    fact_sales.budget_revenue,\n    fact_sales.sales_cost,\n    dim_date.date,\n    dim_product.category\n  FROM public.fact_sales\n  JOIN public.dim_date ON fact_sales.date_sk = dim_date.date_sk\n  JOIN public.dim_product ON fact_sales.product_sk = dim_product.product_sk\n  WHERE dim_date.date >= make_date(extract(year from current_date)::int - 2, 1, 1)\n    AND dim_product.category = 'Electronics'\n),\nagg AS (\n  SELECT\n    date_trunc('month', base.date)::date AS period,\n    SUM(COALESCE(base.revenue, base.quantity * base.unit_price)) AS actual_revenue\n  FROM base\n  GROUP BY 1\n)\nSELECT\n  period,\n  actual_revenue\nFROM agg\nORDER BY actual_revenue DESC, period ASC;", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:58.853+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validating SQL via asyncpg fallback...", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:58.890+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.sql_validation_service", "message": "Validation result: OK", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:58.890+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_validate", "message": "SQL validation PASSED", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:58.892+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "Executing SQL and loading DataFrame...", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:58.893+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Running query via SQLAlchemy fallback...", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:58.968+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.data_extraction", "message": "Query done (rows=15, cols=2)", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:58.968+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.sql_extract", "message": "DataFrame ready (rows=15, cols=2)", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:58.970+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_extractor", "message": "Extracted df shape: (15, 2)", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:58.970+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Rendering chart for question 1...", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:58.972+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.render_chart", "message": "Rendering chart with LLM for DataQuestion: Show revenue for the Electronics category by month.", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:58.972+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Built prompt for chart generation CHART HINT (JSON):\n{'encoding_rules': ['Use a line chart to show actual revenue over time by month for the Electronics category.', 'X-axis: month, Y-axis: actual revenue.', 'Filter data to only include product_category = Electronics.', 'Show data aggregated monthly.']}\n\nPREVIOUS RENDER CHART VALIDATION ERRORS:\nNone\nPlease resolve any validation errors identified above when rendering the chart.\n\nData Set:\n```json\n[{\"period\":\"2024-09-01\",\"actual_revenue\":804656.48},{\"period\":\"2024-10-01\",\"actual_revenue\":3963415.1099999999},{\"period\":\"2024-11-01\",\"actual_revenue\":3793389.48},{\"period\":\"2024-12-01\",\"actual_revenue\":3836732.8999999999},{\"period\":\"2025-01-01\",\"actual_revenue\":3588033.02},{\"period\":\"2025-02-01\",\"actual_revenue\":3237355.3300000001},{\"period\":\"2025-03-01\",\"actual_revenue\":3547225.0499999998},{\"period\":\"2025-04-01\",\"actual_revenue\":3848035.6000000001},{\"period\":\"2025-05-01\",\"actual_revenue\":3866421.3100000001},{\"period\":\"2025-06-01\",\"actual_revenue\":3628216.23},{\"period\":\"2025-07-01\",\"actual_revenue\":3826976.02},{\"period\":\"2025-08-01\",\"actual_revenue\":3931035.6699999999},{\"period\":\"2025-09-01\",\"actual_revenue\":4127413.7799999998},{\"period\":\"2025-10-01\",\"actual_revenue\":5322111.5800000001},{\"period\":\"2025-11-01\",\"actual_revenue\":1539073.49}]\n```", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:36:58.972+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Sending charting prompt to LLM (len=1272)", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:37:08.520+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.llm", "event": "llm_usage", "model": "gpt-4.1-mini", "prompt_tokens": 973, "completion_tokens": 688, "total_tokens": 1661, "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:37:08.520+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "LLM returned charting response (len=2226)", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:37:08.522+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Validating chart JSON...", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:37:08.522+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart JSON preview (len=898):\n{'data': [{'type': 'scatter', 'mode': 'lines+markers', 'x': ['2024-09-01', '2024-10-01', '2024-11-01', '2024-12-01', '2025-01-01', '2025-02-01', '2025-03-01', '2025-04-01', '2025-05-01', '2025-06-01', '2025-07-01', '2025-08-01', '2025-09-01', '2025-10-01', '2025-11-01'], 'y': [804656.48, 3963415.11, 3793389.48, 3836732.9, 3588033.02, 3237355.33, 3547225.05, 3848035.6, 3866421.31, 3628216.23, 3826976.02, 3931035.67, 4127413.78, 5322111.58, 1539073.49], 'name': 'Actual Revenue', 'line': {'color': '#1f77b4'}, 'marker': {'color': '#1f77b4'}}], 'layout': {'title': {'text': 'Monthly Actual Revenue for Electronics Category', 'x': 0.5}, 'xaxis': {'title': 'Month', 'type': 'date', 'tickformat': '%Y-%m', 'tickangle': -45}, 'yaxis': {'title': 'Actual Revenue', 'tickformat': ',.0f'}, 'legend': {'x': 1, 'y': 1, 'xanchor': 'right', 'yanchor': 'top'}, 'margin': {'t': 50, 'b': 100, 'l': 70, 'r': 70}}}", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:37:08.523+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "chart_full_json:{\"data\": [{\"type\": \"scatter\", \"mode\": \"lines+markers\", \"x\": [\"2024-09-01\", \"2024-10-01\", \"2024-11-01\", \"2024-12-01\", \"2025-01-01\", \"2025-02-01\", \"2025-03-01\", \"2025-04-01\", \"2025-05-01\", \"2025-06-01\", \"2025-07-01\", \"2025-08-01\", \"2025-09-01\", \"2025-10-01\", \"2025-11-01\"], \"y\": [804656.48, 3963415.11, 3793389.48, 3836732.9, 3588033.02, 3237355.33, 3547225.05, 3848035.6, 3866421.31, 3628216.23, 3826976.02, 3931035.67, 4127413.78, 5322111.58, 1539073.49], \"name\": \"Actual Revenue\", \"line\": {\"color\": \"#1f77b4\"}, \"marker\": {\"color\": \"#1f77b4\"}}], \"layout\": {\"title\": {\"text\": \"Monthly Actual Revenue for Electronics Category\", \"x\": 0.5}, \"xaxis\": {\"title\": \"Month\", \"type\": \"date\", \"tickformat\": \"%Y-%m\", \"tickangle\": -45}, \"yaxis\": {\"title\": \"Actual Revenue\", \"tickformat\": \",.0f\"}, \"legend\": {\"x\": 1, \"y\": 1, \"xanchor\": \"right\", \"yanchor\": \"top\"}, \"margin\": {\"t\": 50, \"b\": 100, \"l\": 70, \"r\": 70}}}", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:37:08.524+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Saved chart JSON to /Users/praveshkasseran/Documents/Projects/readytensor_projects/ai-powered-analytics-assistant/logs/charts/e8c5e965146e.json", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:37:08.529+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.services.charting_llm", "message": "Chart validation tool result: {'valid': True}", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:37:08.530+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.chart_validate", "message": "Chart validation PASSED", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:37:08.532+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.run_render_chart_for_question", "message": "Chart rendered. Valid: True", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:37:08.536+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:37:08.538+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada.nodes.accumulate", "message": "Advance: processed=1 next_idx=1", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:37:08.541+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "progress", "message": "Chart rendered successfully.", "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:37:08.543+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_state_summary", "is_valid": true, "processed_count": 1, "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:37:08.543+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_render_start", "dq_index": 1, "original_text": "Show revenue for the Electronics category by month.", "has_chart": true, "has_narrative": true, "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:37:08.545+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_chart_rendered", "dq_index": 1, "chart_json_len": 898, "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:37:08.546+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "dq_narrative_rendered", "dq_index": 1, "narrative_len": 630, "test_id": "e8c5e965146e"}
{"timestamp": "2025-11-18T01:37:08.546+00:00Z", "level": "INFO", "session_id": "3bc8ae88-c79a-4b42-922e-1ff56e24e59e", "logger": "ada", "event": "run_completed", "status": "ok", "test_id": "e8c5e965146e"}
